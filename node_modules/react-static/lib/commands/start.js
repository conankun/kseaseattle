"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _getRoutes = _interopRequireDefault(require("../static/getRoutes"));

var _generateBrowserPlugins = _interopRequireDefault(require("../static/generateBrowserPlugins"));

var _runDevServer = _interopRequireDefault(require("../static/webpack/runDevServer"));

var _fetchSiteData = _interopRequireDefault(require("../static/fetchSiteData"));

var _getConfig = _interopRequireDefault(require("../static/getConfig"));

var _extractTemplates = _interopRequireDefault(require("../static/extractTemplates"));

var _generateTemplates = _interopRequireDefault(require("../static/generateTemplates"));

var _createIndexPlaceholder = _interopRequireDefault(require("../utils/createIndexPlaceholder"));

//
var _default =
/*#__PURE__*/
function () {
  var _start = (0, _asyncToGenerator2["default"])(
  /*#__PURE__*/
  _regenerator["default"].mark(function _callee3() {
    var state,
        _args3 = arguments;
    return _regenerator["default"].wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            state = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : {};

            // ensure ENV variables are set
            if (typeof process.env.NODE_ENV === 'undefined') {
              process.env.NODE_ENV = 'development';
            }

            process.env.REACT_STATIC_ENV = 'development';
            process.env.BABEL_ENV = 'development';
            state.stage = 'dev';
            console.log("Starting Development Server..."); // Use a callback (a subscription)

            (0, _getConfig["default"])(state,
            /*#__PURE__*/
            function () {
              var _ref = (0, _asyncToGenerator2["default"])(
              /*#__PURE__*/
              _regenerator["default"].mark(function _callee2(state) {
                return _regenerator["default"].wrap(function _callee2$(_context2) {
                  while (1) {
                    switch (_context2.prev = _context2.next) {
                      case 0:
                        _context2.next = 2;
                        return (0, _fetchSiteData["default"])(state);

                      case 2:
                        state = _context2.sent;
                        _context2.next = 5;
                        return (0, _createIndexPlaceholder["default"])(state);

                      case 5:
                        state = _context2.sent;
                        _context2.next = 8;
                        return (0, _generateBrowserPlugins["default"])(state);

                      case 8:
                        state = _context2.sent;
                        _context2.next = 11;
                        return (0, _getRoutes["default"])(state,
                        /*#__PURE__*/
                        function () {
                          var _ref2 = (0, _asyncToGenerator2["default"])(
                          /*#__PURE__*/
                          _regenerator["default"].mark(function _callee(state) {
                            return _regenerator["default"].wrap(function _callee$(_context) {
                              while (1) {
                                switch (_context.prev = _context.next) {
                                  case 0:
                                    _context.next = 2;
                                    return (0, _extractTemplates["default"])(state);

                                  case 2:
                                    state = _context.sent;
                                    _context.next = 5;
                                    return (0, _generateTemplates["default"])(state);

                                  case 5:
                                    state = _context.sent;
                                    _context.next = 8;
                                    return (0, _runDevServer["default"])(state);

                                  case 8:
                                    state = _context.sent;

                                  case 9:
                                  case "end":
                                    return _context.stop();
                                }
                              }
                            }, _callee);
                          }));

                          return function (_x2) {
                            return _ref2.apply(this, arguments);
                          };
                        }());

                      case 11:
                      case "end":
                        return _context2.stop();
                    }
                  }
                }, _callee2);
              }));

              return function (_x) {
                return _ref.apply(this, arguments);
              };
            }());
            _context3.next = 9;
            return new Promise(function () {// Do nothing indefinitely, the user must exit this command
            });

          case 9:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  }));

  function start() {
    return _start.apply(this, arguments);
  }

  return start;
}();

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kcy9zdGFydC5qcyJdLCJuYW1lcyI6WyJzdGF0ZSIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIlJFQUNUX1NUQVRJQ19FTlYiLCJCQUJFTF9FTlYiLCJzdGFnZSIsImNvbnNvbGUiLCJsb2ciLCJQcm9taXNlIiwic3RhcnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7OytCQUVnQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFxQkEsWUFBQUEsS0FBckIsOERBQTZCLEVBQTdCOztBQUNkO0FBQ0EsZ0JBQUksT0FBT0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFFBQW5CLEtBQWdDLFdBQXBDLEVBQWlEO0FBQy9DRixjQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsUUFBWixHQUF1QixhQUF2QjtBQUNEOztBQUVERixZQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUUsZ0JBQVosR0FBK0IsYUFBL0I7QUFDQUgsWUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlHLFNBQVosR0FBd0IsYUFBeEI7QUFFQUwsWUFBQUEsS0FBSyxDQUFDTSxLQUFOLEdBQWMsS0FBZDtBQUVBQyxZQUFBQSxPQUFPLENBQUNDLEdBQVIsbUNBWGMsQ0FhZDs7QUFDQSx1Q0FBVVIsS0FBVjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsMkNBQWlCLGtCQUFNQSxLQUFOO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLCtCQUNELCtCQUFjQSxLQUFkLENBREM7O0FBQUE7QUFDZkEsd0JBQUFBLEtBRGU7QUFBQTtBQUFBLCtCQUVELHdDQUF1QkEsS0FBdkIsQ0FGQzs7QUFBQTtBQUVmQSx3QkFBQUEsS0FGZTtBQUFBO0FBQUEsK0JBR0Qsd0NBQXVCQSxLQUF2QixDQUhDOztBQUFBO0FBR2ZBLHdCQUFBQSxLQUhlO0FBQUE7QUFBQSwrQkFPVCwyQkFBVUEsS0FBVjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdURBQWlCLGlCQUFNQSxLQUFOO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLDJDQUNQLGtDQUFpQkEsS0FBakIsQ0FETzs7QUFBQTtBQUNyQkEsb0NBQUFBLEtBRHFCO0FBQUE7QUFBQSwyQ0FFUCxtQ0FBa0JBLEtBQWxCLENBRk87O0FBQUE7QUFFckJBLG9DQUFBQSxLQUZxQjtBQUFBO0FBQUEsMkNBR1AsOEJBQWFBLEtBQWIsQ0FITzs7QUFBQTtBQUdyQkEsb0NBQUFBLEtBSHFCOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLDJCQUFqQjs7QUFBQTtBQUFBO0FBQUE7QUFBQSw0QkFQUzs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxlQUFqQjs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQWRjO0FBQUEsbUJBNEJSLElBQUlTLE9BQUosQ0FBWSxZQUFNLENBQ3RCO0FBQ0QsYUFGSyxDQTVCUTs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxHOztXQUFlQyxLOzs7O1NBQUFBLEsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZ2V0Um91dGVzIGZyb20gJy4uL3N0YXRpYy9nZXRSb3V0ZXMnXG5pbXBvcnQgZ2VuZXJhdGVCcm93c2VyUGx1Z2lucyBmcm9tICcuLi9zdGF0aWMvZ2VuZXJhdGVCcm93c2VyUGx1Z2lucydcbmltcG9ydCBydW5EZXZTZXJ2ZXIgZnJvbSAnLi4vc3RhdGljL3dlYnBhY2svcnVuRGV2U2VydmVyJ1xuaW1wb3J0IGZldGNoU2l0ZURhdGEgZnJvbSAnLi4vc3RhdGljL2ZldGNoU2l0ZURhdGEnXG5pbXBvcnQgZ2V0Q29uZmlnIGZyb20gJy4uL3N0YXRpYy9nZXRDb25maWcnXG5pbXBvcnQgZXh0cmFjdFRlbXBsYXRlcyBmcm9tICcuLi9zdGF0aWMvZXh0cmFjdFRlbXBsYXRlcydcbmltcG9ydCBnZW5lcmF0ZVRlbXBsYXRlcyBmcm9tICcuLi9zdGF0aWMvZ2VuZXJhdGVUZW1wbGF0ZXMnXG5pbXBvcnQgY3JlYXRlSW5kZXhQbGFjZWhvbGRlciBmcm9tICcuLi91dGlscy9jcmVhdGVJbmRleFBsYWNlaG9sZGVyJ1xuLy9cblxuZXhwb3J0IGRlZmF1bHQgKGFzeW5jIGZ1bmN0aW9uIHN0YXJ0KHN0YXRlID0ge30pIHtcbiAgLy8gZW5zdXJlIEVOViB2YXJpYWJsZXMgYXJlIHNldFxuICBpZiAodHlwZW9mIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndW5kZWZpbmVkJykge1xuICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ2RldmVsb3BtZW50J1xuICB9XG5cbiAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX0VOViA9ICdkZXZlbG9wbWVudCdcbiAgcHJvY2Vzcy5lbnYuQkFCRUxfRU5WID0gJ2RldmVsb3BtZW50J1xuXG4gIHN0YXRlLnN0YWdlID0gJ2RldidcblxuICBjb25zb2xlLmxvZyhgU3RhcnRpbmcgRGV2ZWxvcG1lbnQgU2VydmVyLi4uYClcblxuICAvLyBVc2UgYSBjYWxsYmFjayAoYSBzdWJzY3JpcHRpb24pXG4gIGdldENvbmZpZyhzdGF0ZSwgYXN5bmMgc3RhdGUgPT4ge1xuICAgIHN0YXRlID0gYXdhaXQgZmV0Y2hTaXRlRGF0YShzdGF0ZSlcbiAgICBzdGF0ZSA9IGF3YWl0IGNyZWF0ZUluZGV4UGxhY2Vob2xkZXIoc3RhdGUpXG4gICAgc3RhdGUgPSBhd2FpdCBnZW5lcmF0ZUJyb3dzZXJQbHVnaW5zKHN0YXRlKVxuXG4gICAgLy8gVXNlIGEgY2FsbGJhY2sgKGEgc3Vic2NyaXB0aW9uKVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgIGF3YWl0IGdldFJvdXRlcyhzdGF0ZSwgYXN5bmMgc3RhdGUgPT4ge1xuICAgICAgc3RhdGUgPSBhd2FpdCBleHRyYWN0VGVtcGxhdGVzKHN0YXRlKVxuICAgICAgc3RhdGUgPSBhd2FpdCBnZW5lcmF0ZVRlbXBsYXRlcyhzdGF0ZSlcbiAgICAgIHN0YXRlID0gYXdhaXQgcnVuRGV2U2VydmVyKHN0YXRlKVxuICAgIH0pXG4gIH0pXG5cbiAgYXdhaXQgbmV3IFByb21pc2UoKCkgPT4ge1xuICAgIC8vIERvIG5vdGhpbmcgaW5kZWZpbml0ZWx5LCB0aGUgdXNlciBtdXN0IGV4aXQgdGhpcyBjb21tYW5kXG4gIH0pXG59KVxuIl19