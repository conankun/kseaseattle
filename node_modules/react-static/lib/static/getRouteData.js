"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = getRouteData;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function getRouteData(_x, _x2) {
  return _getRouteData.apply(this, arguments);
}

function _getRouteData() {
  _getRouteData = (0, _asyncToGenerator2["default"])(
  /*#__PURE__*/
  _regenerator["default"].mark(function _callee(route, state) {
    var sharedDataByHash,
        data,
        sharedHashesByProp,
        newSharedData,
        _args = arguments;
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            sharedDataByHash = _args.length > 2 && _args[2] !== undefined ? _args[2] : new Map();
            _context.t0 = !!route.getData;

            if (!_context.t0) {
              _context.next = 6;
              break;
            }

            _context.next = 5;
            return route.getData(_objectSpread({}, state, {
              route: route
            }));

          case 5:
            _context.t0 = _context.sent;

          case 6:
            data = _context.t0;
            // Default data (must be an object)
            data = data || {}; // Extract any shared data

            sharedHashesByProp = {};
            newSharedData = {};

            if (route.sharedData) {
              Object.keys(route.sharedData).forEach(function (name) {
                var sharedPiece = route.sharedData[name];
                sharedDataByHash.set(sharedPiece.hash, sharedPiece);
                sharedHashesByProp[name] = sharedPiece.hash;
                newSharedData[name] = sharedPiece.data;
              });
            }

            return _context.abrupt("return", _objectSpread({}, route, {
              data: data,
              sharedHashesByProp: sharedHashesByProp,
              sharedData: newSharedData
            }));

          case 12:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));
  return _getRouteData.apply(this, arguments);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdGF0aWMvZ2V0Um91dGVEYXRhLmpzIl0sIm5hbWVzIjpbImdldFJvdXRlRGF0YSIsInJvdXRlIiwic3RhdGUiLCJzaGFyZWREYXRhQnlIYXNoIiwiTWFwIiwiZ2V0RGF0YSIsImRhdGEiLCJzaGFyZWRIYXNoZXNCeVByb3AiLCJuZXdTaGFyZWREYXRhIiwic2hhcmVkRGF0YSIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwibmFtZSIsInNoYXJlZFBpZWNlIiwic2V0IiwiaGFzaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztTQUE4QkEsWTs7Ozs7OzsrQkFBZixpQkFDYkMsS0FEYSxFQUViQyxLQUZhO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR2JDLFlBQUFBLGdCQUhhLDJEQUdNLElBQUlDLEdBQUosRUFITjtBQUFBLDBCQU1GLENBQUMsQ0FBQ0gsS0FBSyxDQUFDSSxPQU5OOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUEsbUJBTXdCSixLQUFLLENBQUNJLE9BQU4sbUJBQW1CSCxLQUFuQjtBQUEwQkQsY0FBQUEsS0FBSyxFQUFMQTtBQUExQixlQU54Qjs7QUFBQTtBQUFBOztBQUFBO0FBTVRLLFlBQUFBLElBTlM7QUFPYjtBQUNBQSxZQUFBQSxJQUFJLEdBQUdBLElBQUksSUFBSSxFQUFmLENBUmEsQ0FTYjs7QUFDTUMsWUFBQUEsa0JBVk8sR0FVYyxFQVZkO0FBV1BDLFlBQUFBLGFBWE8sR0FXUyxFQVhUOztBQWFiLGdCQUFJUCxLQUFLLENBQUNRLFVBQVYsRUFBc0I7QUFDcEJDLGNBQUFBLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZVixLQUFLLENBQUNRLFVBQWxCLEVBQThCRyxPQUE5QixDQUFzQyxVQUFBQyxJQUFJLEVBQUk7QUFDNUMsb0JBQU1DLFdBQVcsR0FBR2IsS0FBSyxDQUFDUSxVQUFOLENBQWlCSSxJQUFqQixDQUFwQjtBQUNBVixnQkFBQUEsZ0JBQWdCLENBQUNZLEdBQWpCLENBQXFCRCxXQUFXLENBQUNFLElBQWpDLEVBQXVDRixXQUF2QztBQUNBUCxnQkFBQUEsa0JBQWtCLENBQUNNLElBQUQsQ0FBbEIsR0FBMkJDLFdBQVcsQ0FBQ0UsSUFBdkM7QUFDQVIsZ0JBQUFBLGFBQWEsQ0FBQ0ssSUFBRCxDQUFiLEdBQXNCQyxXQUFXLENBQUNSLElBQWxDO0FBQ0QsZUFMRDtBQU1EOztBQXBCWSwrREF1QlJMLEtBdkJRO0FBd0JYSyxjQUFBQSxJQUFJLEVBQUpBLElBeEJXO0FBeUJYQyxjQUFBQSxrQkFBa0IsRUFBbEJBLGtCQXpCVztBQTBCWEUsY0FBQUEsVUFBVSxFQUFFRDtBQTFCRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxHIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gZ2V0Um91dGVEYXRhKFxuICByb3V0ZSxcbiAgc3RhdGUsXG4gIHNoYXJlZERhdGFCeUhhc2ggPSBuZXcgTWFwKClcbikge1xuICAvLyBGZXRjaCBkYXRhIGZyb20gZWFjaCByb3V0ZVxuICBsZXQgZGF0YSA9ICEhcm91dGUuZ2V0RGF0YSAmJiAoYXdhaXQgcm91dGUuZ2V0RGF0YSh7IC4uLnN0YXRlLCByb3V0ZSB9KSlcbiAgLy8gRGVmYXVsdCBkYXRhIChtdXN0IGJlIGFuIG9iamVjdClcbiAgZGF0YSA9IGRhdGEgfHwge31cbiAgLy8gRXh0cmFjdCBhbnkgc2hhcmVkIGRhdGFcbiAgY29uc3Qgc2hhcmVkSGFzaGVzQnlQcm9wID0ge31cbiAgY29uc3QgbmV3U2hhcmVkRGF0YSA9IHt9XG5cbiAgaWYgKHJvdXRlLnNoYXJlZERhdGEpIHtcbiAgICBPYmplY3Qua2V5cyhyb3V0ZS5zaGFyZWREYXRhKS5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgY29uc3Qgc2hhcmVkUGllY2UgPSByb3V0ZS5zaGFyZWREYXRhW25hbWVdXG4gICAgICBzaGFyZWREYXRhQnlIYXNoLnNldChzaGFyZWRQaWVjZS5oYXNoLCBzaGFyZWRQaWVjZSlcbiAgICAgIHNoYXJlZEhhc2hlc0J5UHJvcFtuYW1lXSA9IHNoYXJlZFBpZWNlLmhhc2hcbiAgICAgIG5ld1NoYXJlZERhdGFbbmFtZV0gPSBzaGFyZWRQaWVjZS5kYXRhXG4gICAgfSlcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgLi4ucm91dGUsXG4gICAgZGF0YSxcbiAgICBzaGFyZWRIYXNoZXNCeVByb3AsXG4gICAgc2hhcmVkRGF0YTogbmV3U2hhcmVkRGF0YSxcbiAgfVxufVxuIl19