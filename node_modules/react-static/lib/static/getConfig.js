"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = getConfig;
exports.buildConfig = buildConfig;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _path = _interopRequireDefault(require("path"));

var _chokidar = _interopRequireDefault(require("chokidar"));

var _resolveFrom = _interopRequireDefault(require("resolve-from"));

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _utils = require("../utils");

var _plugins = _interopRequireWildcard(require("./plugins"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

// the default static.config.js location
var defaultConfig = {};
var DEFAULT_NAME_FOR_STATIC_CONFIG_FILE = 'static.config.js';

var DEFAULT_PATH_FOR_STATIC_CONFIG = _path["default"].resolve(_path["default"].join(process.cwd(), DEFAULT_NAME_FOR_STATIC_CONFIG_FILE));

var DEFAULT_ROUTES = [{
  path: '/'
}];
var DEFAULT_ENTRY = 'index.js';
var DEFAULT_EXTENSIONS = ['.js', '.jsx']; // Retrieves the static.config.js from the current project directory

function getConfig(state) {
  var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] :
  /*#__PURE__*/
  function () {
    var _ref = (0, _asyncToGenerator2["default"])(
    /*#__PURE__*/
    _regenerator["default"].mark(function _callee(config) {
      return _regenerator["default"].wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              if (state.debug) {
                console.log('getConfig():');
                console.log(state);
              }

              return _context.abrupt("return", config);

            case 2:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x) {
      return _ref.apply(this, arguments);
    };
  }();
  var configPath = state.configPath || state.packageConfig.config || DEFAULT_PATH_FOR_STATIC_CONFIG;
  state = _objectSpread({}, state, {
    originalConfig: configPath
  });

  var resolvedPath = _path["default"].resolve(configPath);

  var noConfig = configPath === DEFAULT_PATH_FOR_STATIC_CONFIG && !resolvedPath;

  if (noConfig) {
    // last
    state = buildConfig(state, defaultConfig);
    return callback(state)["catch"](console.error);
  }

  state = buildConfigFromPath(state, resolvedPath || configPath);

  if (state.stage === 'dev') {
    _chokidar["default"].watch(resolvedPath, {
      ignoreInitial: true
    }).on('all',
    /*#__PURE__*/
    (0, _asyncToGenerator2["default"])(
    /*#__PURE__*/
    _regenerator["default"].mark(function _callee2() {
      return _regenerator["default"].wrap(function _callee2$(_context2) {
        while (1) {
          switch (_context2.prev = _context2.next) {
            case 0:
              console.log('');
              console.log("Updating static.config.js");
              state = buildConfigFromPath(state, resolvedPath);
              callback(state)["catch"](console.error);

            case 4:
            case "end":
              return _context2.stop();
          }
        }
      }, _callee2);
    })));
  }

  return callback(state)["catch"](console.error);
}

function buildConfigFromPath(state, configPath) {
  delete require.cache[configPath];

  var config = require(configPath)["default"];

  return buildConfig(state, config);
}

function buildConfig(state) {
  var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  // Default Paths
  var paths = _objectSpread({
    root: _path["default"].resolve(process.cwd()),
    src: 'src',
    dist: 'dist',
    temp: 'tmp',
    buildArtifacts: 'artifacts',
    devDist: 'tmp/dev-server',
    "public": 'public',
    plugins: 'plugins',
    pages: 'src/pages',
    nodeModules: 'node_modules',
    assets: ''
  }, config.paths || {}); // Use the root to resolve all other relative paths


  var resolvePath = function resolvePath(relativePath) {
    return _path["default"].resolve(paths.root, relativePath);
  }; // Resolve and replace all pathss


  var DIST = process.env.REACT_STATIC_ENV === 'development' ? resolvePath(paths.devDist || paths.dist) : resolvePath(paths.dist);

  var ASSETS = _path["default"].resolve(DIST, paths.assets);

  paths = {
    ROOT: paths.root,
    SRC: resolvePath(paths.src),
    DIST: DIST,
    ASSETS: ASSETS,
    PLUGINS: resolvePath(paths.plugins),
    TEMP: resolvePath(paths.temp),
    ARTIFACTS: resolvePath(paths.buildArtifacts),
    PUBLIC: resolvePath(paths["public"]),
    NODE_MODULES: resolvePath(paths.nodeModules),
    EXCLUDE_MODULES: paths.excludeResolvedModules || resolvePath(paths.nodeModules),
    PACKAGE: resolvePath('package.json'),
    HTML_TEMPLATE: _path["default"].join(DIST, 'index.html'),
    STATIC_DATA: _path["default"].join(ASSETS, 'staticData') // siteRoot, basePath, publicPath, and assetPath resolution

  };
  var siteRoot = '';
  var basePath = '';
  var assetsPath = '';

  if (process.env.REACT_STATIC_ENV === 'development') {
    basePath = (0, _utils.cleanSlashes)(config.devBasePath);
    assetsPath = config.devAssetsPath || paths.assets || assetsPath;
  } else if (state.staging) {
    siteRoot = (0, _utils.cutPathToRoot)(config.stagingSiteRoot || '/', '$1');
    basePath = (0, _utils.cleanSlashes)(config.stagingBasePath);
    assetsPath = config.stagingAssetsPath || paths.assets || assetsPath;
  } else {
    siteRoot = (0, _utils.cutPathToRoot)(config.siteRoot || '/', '$1');
    basePath = (0, _utils.cleanSlashes)(config.basePath);
    assetsPath = config.assetsPath || paths.assets || assetsPath;
  }

  var publicPath = "".concat((0, _utils.cleanSlashes)("".concat(siteRoot, "/").concat(basePath), {
    leading: false
  }), "/");

  if (assetsPath && !(0, _utils.isAbsoluteUrl)(assetsPath)) {
    assetsPath = "/".concat((0, _utils.cleanSlashes)("".concat(basePath, "/").concat(assetsPath)), "/");
  } // add trailing slash only if assetsPath was supplied, but no trailing slash


  if (assetsPath && !assetsPath.endsWith('/')) {
    assetsPath = "".concat(assetsPath, "/");
  } // Add the project root as a plugin. This allows the dev
  // to use the plugin api directory in their project if they want


  var plugins = [].concat((0, _toConsumableArray2["default"])(config.plugins || []), [paths.ROOT]); // if (process.env.NODE_ENV !== 'test' && !entry) {
  //   throw new Error(
  //     `Could not resolve entry file from location: ${entry} using extensions: ${(
  //       config.extensions || DEFAULT_EXTENSIONS
  //     ).join(', ')}`
  //   )
  // }
  // Defaults

  config = _objectSpread({
    // Defaults
    getSiteData: function getSiteData() {
      return {};
    },
    prefetchRate: 5,
    maxThreads: Infinity,
    disableRoutePrefixing: false,
    outputFileRate: 100,
    extensions: DEFAULT_EXTENSIONS,
    getRoutes: function () {
      var _getRoutes = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee3() {
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                return _context3.abrupt("return", DEFAULT_ROUTES);

              case 1:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3);
      }));

      function getRoutes() {
        return _getRoutes.apply(this, arguments);
      }

      return getRoutes;
    }(),
    minLoadTime: 200,
    disablePreload: false,
    disableRuntime: false,
    preloadPollInterval: 300,
    productionSourceMaps: false,
    silent: false,
    entry: DEFAULT_ENTRY
  }, config, {
    // Materialized Overrides
    paths: paths,
    plugins: plugins,
    siteRoot: siteRoot,
    basePath: basePath,
    publicPath: publicPath,
    assetsPath: assetsPath,
    extractCssChunks: config.extractCssChunks || false,
    inlineCss: config.inlineCss || false,
    babelExcludes: config.babelExcludes || [],
    devServer: _objectSpread({
      host: 'localhost',
      port: 3000
    }, config.devServer || {})
  });
  config.terser = config.terser || {};
  config.terser.terserOptions = config.terser.terserOptions || {};
  config.terser.terserOptions.mangle = config.terser.terserOptions.mangle || {};
  config.terser.terserOptions.parse = config.terser.terserOptions.parse || {};
  config.terser.terserOptions.compress = config.terser.terserOptions.compress || {};
  config.terser.terserOptions.output = config.terser.terserOptions.output || {}; // Set env variables to be used client side

  process.env.REACT_STATIC_MIN_LOAD_TIME = config.minLoadTime;
  process.env.REACT_STATIC_PREFETCH_RATE = config.prefetchRate;
  process.env.REACT_STATIC_DISABLE_ROUTE_PREFIXING = config.disableRoutePrefixing;
  process.env.REACT_STATIC_DISABLE_PRELOAD = config.disablePreload;
  process.env.REACT_STATIC_DISABLE_RUNTIME = config.disableRuntime;
  process.env.REACT_STATIC_PRELOAD_POLL_INTERVAL = config.preloadPollInterval;
  process.env.REACT_STATIC_SILENT = config.silent;
  process.env.REACT_STATIC_ROOT_PATH_READ_ONLY = paths.ROOT;
  process.env.REACT_STATIC_TEMPLATES_PATH = _path["default"].join(paths.ARTIFACTS, 'react-static-templates.js');
  process.env.REACT_STATIC_PLUGINS_PATH = _path["default"].join(paths.ARTIFACTS, 'react-static-browser-plugins.js');

  var resolvePlugin = function resolvePlugin(originalLocation) {
    var options = {};

    if (Array.isArray(originalLocation)) {
      options = originalLocation[1] || {};
      originalLocation = originalLocation[0];
    }

    var location = [function () {
      // Absolute require
      try {
        var found = require.resolve(originalLocation);

        return found.includes('.') ? _path["default"].resolve(found, '../') : found;
      } catch (err) {//
      }
    }, function () {
      // Absolute
      if (_fsExtra["default"].pathExistsSync(originalLocation)) {
        return originalLocation;
      }
    }, function () {
      // Plugins Dir
      var found = _path["default"].resolve(paths.PLUGINS, originalLocation);

      if (_fsExtra["default"].pathExistsSync(found)) {
        return found;
      }
    }, function () {
      // Plugins Dir require
      try {
        var found = (0, _resolveFrom["default"])(paths.PLUGINS, originalLocation);
        return found.includes('.') ? _path["default"].resolve(found, '../') : found;
      } catch (err) {//
      }
    }, function () {
      // CWD
      var found = _path["default"].resolve(process.cwd(), originalLocation);

      if (_fsExtra["default"].pathExistsSync(found)) {
        return found;
      }
    }, function () {
      // CWD require
      try {
        var found = (0, _resolveFrom["default"])(process.cwd(), originalLocation);
        return found.includes('.') ? _path["default"].resolve(found, '../') : found;
      } catch (err) {//
      }
    }, function () {
      if (process.env.NODE_ENV === 'test') {
        // Allow plugins to be mocked
        return require('path').resolve('./src/static/__mocks__/mock-plugin');
      }
    }].reduce(function (prev, curr) {
      return prev || curr();
    }, null); // TODO: We have to do this because we don't have a good mock for process.cwd() :(

    if (!location) {
      throw new Error("Could not find a plugin directory for the plugin: \"".concat(originalLocation, "\". We must bail!"));
    }

    var nodeLocation = _path["default"].join(location, 'node.api.js');

    var browserLocation = _path["default"].join(location, 'browser.api.js'); // Detect if the node plugin entry exists, and provide the nodeResolver to it


    nodeLocation = _fsExtra["default"].pathExistsSync(nodeLocation) ? nodeLocation : null; // Detect if the browser plugin entry exists, and provide the nodeResolver to it

    browserLocation = _fsExtra["default"].pathExistsSync(browserLocation) ? browserLocation : null;

    var buildPluginHooks = function buildPluginHooks() {
      return {};
    };

    try {
      // Get the hooks for the node api
      if (nodeLocation) {
        buildPluginHooks = require(nodeLocation)["default"];
      } else if (originalLocation !== paths.ROOT && !browserLocation) {
        throw new Error("Could not find a valid node.api.js or browser.api.js plugin file in \"".concat(location, "\". \n") + "The original location: \"".concat(originalLocation, "\". \n") + "The root location: \"".concat(paths.ROOT, "\"."));
      }

      var resolvedPlugin = {
        location: location,
        nodeLocation: nodeLocation,
        browserLocation: browserLocation,
        options: options,
        hooks: buildPluginHooks(options) || {}
      };
      (0, _plugins.validatePlugin)(resolvedPlugin); // Recursively resolve plugins

      if (resolvedPlugin.plugins) {
        resolvedPlugin.plugins = resolvedPlugin.plugins.map(resolvePlugin);
      }

      return resolvedPlugin;
    } catch (err) {
      console.error("The following error occurred in the plugin: \"".concat(originalLocation, "\""));
      throw err;
    }
  };

  state = _objectSpread({}, state, {
    plugins: config.plugins.map(resolvePlugin),
    config: config
  });
  return _plugins["default"].afterGetConfig(state);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdGF0aWMvZ2V0Q29uZmlnLmpzIl0sIm5hbWVzIjpbImRlZmF1bHRDb25maWciLCJERUZBVUxUX05BTUVfRk9SX1NUQVRJQ19DT05GSUdfRklMRSIsIkRFRkFVTFRfUEFUSF9GT1JfU1RBVElDX0NPTkZJRyIsIm5vZGVQYXRoIiwicmVzb2x2ZSIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiREVGQVVMVF9ST1VURVMiLCJwYXRoIiwiREVGQVVMVF9FTlRSWSIsIkRFRkFVTFRfRVhURU5TSU9OUyIsImdldENvbmZpZyIsInN0YXRlIiwiY2FsbGJhY2siLCJjb25maWciLCJkZWJ1ZyIsImNvbnNvbGUiLCJsb2ciLCJjb25maWdQYXRoIiwicGFja2FnZUNvbmZpZyIsIm9yaWdpbmFsQ29uZmlnIiwicmVzb2x2ZWRQYXRoIiwibm9Db25maWciLCJidWlsZENvbmZpZyIsImVycm9yIiwiYnVpbGRDb25maWdGcm9tUGF0aCIsInN0YWdlIiwiY2hva2lkYXIiLCJ3YXRjaCIsImlnbm9yZUluaXRpYWwiLCJvbiIsInJlcXVpcmUiLCJjYWNoZSIsInBhdGhzIiwicm9vdCIsInNyYyIsImRpc3QiLCJ0ZW1wIiwiYnVpbGRBcnRpZmFjdHMiLCJkZXZEaXN0IiwicGx1Z2lucyIsInBhZ2VzIiwibm9kZU1vZHVsZXMiLCJhc3NldHMiLCJyZXNvbHZlUGF0aCIsInJlbGF0aXZlUGF0aCIsIkRJU1QiLCJlbnYiLCJSRUFDVF9TVEFUSUNfRU5WIiwiQVNTRVRTIiwiUk9PVCIsIlNSQyIsIlBMVUdJTlMiLCJURU1QIiwiQVJUSUZBQ1RTIiwiUFVCTElDIiwiTk9ERV9NT0RVTEVTIiwiRVhDTFVERV9NT0RVTEVTIiwiZXhjbHVkZVJlc29sdmVkTW9kdWxlcyIsIlBBQ0tBR0UiLCJIVE1MX1RFTVBMQVRFIiwiU1RBVElDX0RBVEEiLCJzaXRlUm9vdCIsImJhc2VQYXRoIiwiYXNzZXRzUGF0aCIsImRldkJhc2VQYXRoIiwiZGV2QXNzZXRzUGF0aCIsInN0YWdpbmciLCJzdGFnaW5nU2l0ZVJvb3QiLCJzdGFnaW5nQmFzZVBhdGgiLCJzdGFnaW5nQXNzZXRzUGF0aCIsInB1YmxpY1BhdGgiLCJsZWFkaW5nIiwiZW5kc1dpdGgiLCJnZXRTaXRlRGF0YSIsInByZWZldGNoUmF0ZSIsIm1heFRocmVhZHMiLCJJbmZpbml0eSIsImRpc2FibGVSb3V0ZVByZWZpeGluZyIsIm91dHB1dEZpbGVSYXRlIiwiZXh0ZW5zaW9ucyIsImdldFJvdXRlcyIsIm1pbkxvYWRUaW1lIiwiZGlzYWJsZVByZWxvYWQiLCJkaXNhYmxlUnVudGltZSIsInByZWxvYWRQb2xsSW50ZXJ2YWwiLCJwcm9kdWN0aW9uU291cmNlTWFwcyIsInNpbGVudCIsImVudHJ5IiwiZXh0cmFjdENzc0NodW5rcyIsImlubGluZUNzcyIsImJhYmVsRXhjbHVkZXMiLCJkZXZTZXJ2ZXIiLCJob3N0IiwicG9ydCIsInRlcnNlciIsInRlcnNlck9wdGlvbnMiLCJtYW5nbGUiLCJwYXJzZSIsImNvbXByZXNzIiwib3V0cHV0IiwiUkVBQ1RfU1RBVElDX01JTl9MT0FEX1RJTUUiLCJSRUFDVF9TVEFUSUNfUFJFRkVUQ0hfUkFURSIsIlJFQUNUX1NUQVRJQ19ESVNBQkxFX1JPVVRFX1BSRUZJWElORyIsIlJFQUNUX1NUQVRJQ19ESVNBQkxFX1BSRUxPQUQiLCJSRUFDVF9TVEFUSUNfRElTQUJMRV9SVU5USU1FIiwiUkVBQ1RfU1RBVElDX1BSRUxPQURfUE9MTF9JTlRFUlZBTCIsIlJFQUNUX1NUQVRJQ19TSUxFTlQiLCJSRUFDVF9TVEFUSUNfUk9PVF9QQVRIX1JFQURfT05MWSIsIlJFQUNUX1NUQVRJQ19URU1QTEFURVNfUEFUSCIsIlJFQUNUX1NUQVRJQ19QTFVHSU5TX1BBVEgiLCJyZXNvbHZlUGx1Z2luIiwib3JpZ2luYWxMb2NhdGlvbiIsIm9wdGlvbnMiLCJBcnJheSIsImlzQXJyYXkiLCJsb2NhdGlvbiIsImZvdW5kIiwiaW5jbHVkZXMiLCJlcnIiLCJmcyIsInBhdGhFeGlzdHNTeW5jIiwiTk9ERV9FTlYiLCJyZWR1Y2UiLCJwcmV2IiwiY3VyciIsIkVycm9yIiwibm9kZUxvY2F0aW9uIiwiYnJvd3NlckxvY2F0aW9uIiwiYnVpbGRQbHVnaW5Ib29rcyIsInJlc29sdmVkUGx1Z2luIiwiaG9va3MiLCJtYXAiLCJjb3JlUGx1Z2lucyIsImFmdGVyR2V0Q29uZmlnIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOzs7Ozs7QUFFQTtBQUNBLElBQU1BLGFBQWEsR0FBRyxFQUF0QjtBQUNBLElBQU1DLG1DQUFtQyxHQUFHLGtCQUE1Qzs7QUFDQSxJQUFNQyw4QkFBOEIsR0FBR0MsaUJBQVNDLE9BQVQsQ0FDckNELGlCQUFTRSxJQUFULENBQWNDLE9BQU8sQ0FBQ0MsR0FBUixFQUFkLEVBQTZCTixtQ0FBN0IsQ0FEcUMsQ0FBdkM7O0FBR0EsSUFBTU8sY0FBYyxHQUFHLENBQUM7QUFBRUMsRUFBQUEsSUFBSSxFQUFFO0FBQVIsQ0FBRCxDQUF2QjtBQUNBLElBQU1DLGFBQWEsR0FBRyxVQUF0QjtBQUNBLElBQU1DLGtCQUFrQixHQUFHLENBQUMsS0FBRCxFQUFRLE1BQVIsQ0FBM0IsQyxDQUVBOztBQUNlLFNBQVNDLFNBQVQsQ0FDYkMsS0FEYSxFQVNiO0FBQUEsTUFQQUMsUUFPQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsaUNBUFcsaUJBQU1DLE1BQU47QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNULGtCQUFJRixLQUFLLENBQUNHLEtBQVYsRUFBaUI7QUFDZkMsZ0JBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGNBQVo7QUFDQUQsZ0JBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZTCxLQUFaO0FBQ0Q7O0FBSlEsK0NBS0ZFLE1BTEU7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsS0FPWDs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBLE1BQU1JLFVBQVUsR0FDZE4sS0FBSyxDQUFDTSxVQUFOLElBQ0FOLEtBQUssQ0FBQ08s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QixJQUE2QjtBQUxmLE9BQXZCO0FBUUEsbUNBQWVpQixjQUFmLEVBcEJFLENBc0JGOztBQUNBLFVBQUlBLGNBQWMsQ0FBQzFGLE9BQW5CLEVBQTRCO0FBQzFCMEYsUUFBQUEsY0FBYyxDQUFDMUYsT0FBZixHQUF5QjBGLGNBQWMsQ0FBQzFGLE9BQWYsQ0FBdUI0RixHQUF2QixDQUEyQnJCLGFBQTNCLENBQXpCO0FBQ0Q7O0FBRUQsYUFBT21CLGNBQVA7QUFDRCxLQTVCRCxDQTRCRSxPQUFPWCxHQUFQLEVBQVk7QUFDWnZHLE1BQUFBLE9BQU8sQ0FBQ1EsS0FBUix5REFDa0R3RixnQkFEbEQ7QUFHQSxZQUFNTyxHQUFOO0FBQ0Q7QUFDRixHQXJIRDs7QUF1SEEzRyxFQUFBQSxLQUFLLHFCQUNBQSxLQURBO0FBRUg0QixJQUFBQSxPQUFPLEVBQUUxQixNQUFNLENBQUMwQixPQUFQLENBQWU0RixHQUFmLENBQW1CckIsYUFBbkIsQ0FGTjtBQUdIakcsSUFBQUEsTUFBTSxFQUFOQTtBQUhHLElBQUw7QUFNQSxTQUFPdUgsb0JBQVlDLGNBQVosQ0FBMkIxSCxLQUEzQixDQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBpbXBvcnQvbm8tZHluYW1pYy1yZXF1aXJlICovXG5cbmltcG9ydCBub2RlUGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IGNob2tpZGFyIGZyb20gJ2Nob2tpZGFyJ1xuaW1wb3J0IHJlc29sdmVGcm9tIGZyb20gJ3Jlc29sdmUtZnJvbSdcbmltcG9ydCBmcyBmcm9tICdmcy1leHRyYSdcbi8vXG5pbXBvcnQgeyBjbGVhblNsYXNoZXMsIGN1dFBhdGhUb1Jvb3QsIGlzQWJzb2x1dGVVcmwgfSBmcm9tICcuLi91dGlscydcbmltcG9ydCBjb3JlUGx1Z2lucywgeyB2YWxpZGF0ZVBsdWdpbiB9IGZyb20gJy4vcGx1Z2lucydcblxuLy8gdGhlIGRlZmF1bHQgc3RhdGljLmNvbmZpZy5qcyBsb2NhdGlvblxuY29uc3QgZGVmYXVsdENvbmZpZyA9IHt9XG5jb25zdCBERUZBVUxUX05BTUVfRk9SX1NUQVRJQ19DT05GSUdfRklMRSA9ICdzdGF0aWMuY29uZmlnLmpzJ1xuY29uc3QgREVGQVVMVF9QQVRIX0ZPUl9TVEFUSUNfQ09ORklHID0gbm9kZVBhdGgucmVzb2x2ZShcbiAgbm9kZVBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBERUZBVUxUX05BTUVfRk9SX1NUQVRJQ19DT05GSUdfRklMRSlcbilcbmNvbnN0IERFRkFVTFRfUk9VVEVTID0gW3sgcGF0aDogJy8nIH1dXG5jb25zdCBERUZBVUxUX0VOVFJZID0gJ2luZGV4LmpzJ1xuY29uc3QgREVGQVVMVF9FWFRFTlNJT05TID0gWycuanMnLCAnLmpzeCddXG5cbi8vIFJldHJpZXZlcyB0aGUgc3RhdGljLmNvbmZpZy5qcyBmcm9tIHRoZSBjdXJyZW50IHByb2plY3QgZGlyZWN0b3J5XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnZXRDb25maWcoXG4gIHN0YXRlLFxuICBjYWxsYmFjayA9IGFzeW5jIGNvbmZpZyA9PiB7XG4gICAgaWYgKHN0YXRlLmRlYnVnKSB7XG4gICAgICBjb25zb2xlLmxvZygnZ2V0Q29uZmlnKCk6JylcbiAgICAgIGNvbnNvbGUubG9nKHN0YXRlKVxuICAgIH1cbiAgICByZXR1cm4gY29uZmlnXG4gIH1cbikge1xuICBjb25zdCBjb25maWdQYXRoID1cbiAgICBzdGF0ZS5jb25maWdQYXRoIHx8XG4gICAgc3RhdGUucGFja2FnZUNvbmZpZy5jb25maWcgfHxcbiAgICBERUZBVUxUX1BBVEhfRk9SX1NUQVRJQ19DT05GSUdcblxuICBzdGF0ZSA9IHtcbiAgICAuLi5zdGF0ZSxcbiAgICBvcmlnaW5hbENvbmZpZzogY29uZmlnUGF0aCxcbiAgfVxuXG4gIGNvbnN0IHJlc29sdmVkUGF0aCA9IG5vZGVQYXRoLnJlc29sdmUoY29uZmlnUGF0aClcblxuICBjb25zdCBub0NvbmZpZyA9XG4gICAgY29uZmlnUGF0aCA9PT0gREVGQVVMVF9QQVRIX0ZPUl9TVEFUSUNfQ09ORklHICYmICFyZXNvbHZlZFBhdGhcblxuICBpZiAobm9Db25maWcpIHtcbiAgICAvLyBsYXN0XG4gICAgc3RhdGUgPSBidWlsZENvbmZpZyhzdGF0ZSwgZGVmYXVsdENvbmZpZylcbiAgICByZXR1cm4gY2FsbGJhY2soc3RhdGUpLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gIH1cblxuICBzdGF0ZSA9IGJ1aWxkQ29uZmlnRnJvbVBhdGgoc3RhdGUsIHJlc29sdmVkUGF0aCB8fCBjb25maWdQYXRoKVxuXG4gIGlmIChzdGF0ZS5zdGFnZSA9PT0gJ2RldicpIHtcbiAgICBjaG9raWRhclxuICAgICAgLndhdGNoKHJlc29sdmVkUGF0aCwge1xuICAgICAgICBpZ25vcmVJbml0aWFsOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIC5vbignYWxsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnJylcbiAgICAgICAgY29uc29sZS5sb2coYFVwZGF0aW5nIHN0YXRpYy5jb25maWcuanNgKVxuICAgICAgICBzdGF0ZSA9IGJ1aWxkQ29uZmlnRnJvbVBhdGgoc3RhdGUsIHJlc29sdmVkUGF0aClcbiAgICAgICAgY2FsbGJhY2soc3RhdGUpLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgICB9KVxuICB9XG5cbiAgcmV0dXJuIGNhbGxiYWNrKHN0YXRlKS5jYXRjaChjb25zb2xlLmVycm9yKVxufVxuXG5mdW5jdGlvbiBidWlsZENvbmZpZ0Zyb21QYXRoKHN0YXRlLCBjb25maWdQYXRoKSB7XG4gIGRlbGV0ZSByZXF1aXJlLmNhY2hlW2NvbmZpZ1BhdGhdXG4gIGNvbnN0IGNvbmZpZyA9IHJlcXVpcmUoY29uZmlnUGF0aCkuZGVmYXVsdFxuICByZXR1cm4gYnVpbGRDb25maWcoc3RhdGUsIGNvbmZpZylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkQ29uZmlnKHN0YXRlLCBjb25maWcgPSB7fSkge1xuICAvLyBEZWZhdWx0IFBhdGhzXG4gIGxldCBwYXRocyA9IHtcbiAgICByb290OiBub2RlUGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCkpLFxuICAgIHNyYzogJ3NyYycsXG4gICAgZGlzdDogJ2Rpc3QnLFxuICAgIHRlbXA6ICd0bXAnLFxuICAgIGJ1aWxkQXJ0aWZhY3RzOiAnYXJ0aWZhY3RzJyxcbiAgICBkZXZEaXN0OiAndG1wL2Rldi1zZXJ2ZXInLFxuICAgIHB1YmxpYzogJ3B1YmxpYycsXG4gICAgcGx1Z2luczogJ3BsdWdpbnMnLFxuICAgIHBhZ2VzOiAnc3JjL3BhZ2VzJyxcbiAgICBub2RlTW9kdWxlczogJ25vZGVfbW9kdWxlcycsXG4gICAgYXNzZXRzOiAnJyxcbiAgICAuLi4oY29uZmlnLnBhdGhzIHx8IHt9KSxcbiAgfVxuXG4gIC8vIFVzZSB0aGUgcm9vdCB0byByZXNvbHZlIGFsbCBvdGhlciByZWxhdGl2ZSBwYXRoc1xuICBjb25zdCByZXNvbHZlUGF0aCA9IHJlbGF0aXZlUGF0aCA9PiBub2RlUGF0aC5yZXNvbHZlKHBhdGhzLnJvb3QsIHJlbGF0aXZlUGF0aClcblxuICAvLyBSZXNvbHZlIGFuZCByZXBsYWNlIGFsbCBwYXRoc3NcbiAgY29uc3QgRElTVCA9XG4gICAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX0VOViA9PT0gJ2RldmVsb3BtZW50J1xuICAgICAgPyByZXNvbHZlUGF0aChwYXRocy5kZXZEaXN0IHx8IHBhdGhzLmRpc3QpXG4gICAgICA6IHJlc29sdmVQYXRoKHBhdGhzLmRpc3QpXG4gIGNvbnN0IEFTU0VUUyA9IG5vZGVQYXRoLnJlc29sdmUoRElTVCwgcGF0aHMuYXNzZXRzKVxuXG4gIHBhdGhzID0ge1xuICAgIFJPT1Q6IHBhdGhzLnJvb3QsXG4gICAgU1JDOiByZXNvbHZlUGF0aChwYXRocy5zcmMpLFxuICAgIERJU1QsXG4gICAgQVNTRVRTLFxuICAgIFBMVUdJTlM6IHJlc29sdmVQYXRoKHBhdGhzLnBsdWdpbnMpLFxuICAgIFRFTVA6IHJlc29sdmVQYXRoKHBhdGhzLnRlbXApLFxuICAgIEFSVElGQUNUUzogcmVzb2x2ZVBhdGgocGF0aHMuYnVpbGRBcnRpZmFjdHMpLFxuICAgIFBVQkxJQzogcmVzb2x2ZVBhdGgocGF0aHMucHVibGljKSxcbiAgICBOT0RFX01PRFVMRVM6IHJlc29sdmVQYXRoKHBhdGhzLm5vZGVNb2R1bGVzKSxcbiAgICBFWENMVURFX01PRFVMRVM6XG4gICAgICBwYXRocy5leGNsdWRlUmVzb2x2ZWRNb2R1bGVzIHx8IHJlc29sdmVQYXRoKHBhdGhzLm5vZGVNb2R1bGVzKSxcbiAgICBQQUNLQUdFOiByZXNvbHZlUGF0aCgncGFja2FnZS5qc29uJyksXG4gICAgSFRNTF9URU1QTEFURTogbm9kZVBhdGguam9pbihESVNULCAnaW5kZXguaHRtbCcpLFxuICAgIFNUQVRJQ19EQVRBOiBub2RlUGF0aC5qb2luKEFTU0VUUywgJ3N0YXRpY0RhdGEnKSxcbiAgfVxuXG4gIC8vIHNpdGVSb290LCBiYXNlUGF0aCwgcHVibGljUGF0aCwgYW5kIGFzc2V0UGF0aCByZXNvbHV0aW9uXG4gIGxldCBzaXRlUm9vdCA9ICcnXG4gIGxldCBiYXNlUGF0aCA9ICcnXG4gIGxldCBhc3NldHNQYXRoID0gJydcbiAgaWYgKHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICBiYXNlUGF0aCA9IGNsZWFuU2xhc2hlcyhjb25maWcuZGV2QmFzZVBhdGgpXG4gICAgYXNzZXRzUGF0aCA9IGNvbmZpZy5kZXZBc3NldHNQYXRoIHx8IHBhdGhzLmFzc2V0cyB8fCBhc3NldHNQYXRoXG4gIH0gZWxzZSBpZiAoc3RhdGUuc3RhZ2luZykge1xuICAgIHNpdGVSb290ID0gY3V0UGF0aFRvUm9vdChjb25maWcuc3RhZ2luZ1NpdGVSb290IHx8ICcvJywgJyQxJylcbiAgICBiYXNlUGF0aCA9IGNsZWFuU2xhc2hlcyhjb25maWcuc3RhZ2luZ0Jhc2VQYXRoKVxuICAgIGFzc2V0c1BhdGggPSBjb25maWcuc3RhZ2luZ0Fzc2V0c1BhdGggfHwgcGF0aHMuYXNzZXRzIHx8IGFzc2V0c1BhdGhcbiAgfSBlbHNlIHtcbiAgICBzaXRlUm9vdCA9IGN1dFBhdGhUb1Jvb3QoY29uZmlnLnNpdGVSb290IHx8ICcvJywgJyQxJylcbiAgICBiYXNlUGF0aCA9IGNsZWFuU2xhc2hlcyhjb25maWcuYmFzZVBhdGgpXG4gICAgYXNzZXRzUGF0aCA9IGNvbmZpZy5hc3NldHNQYXRoIHx8IHBhdGhzLmFzc2V0cyB8fCBhc3NldHNQYXRoXG4gIH1cbiAgY29uc3QgcHVibGljUGF0aCA9IGAke2NsZWFuU2xhc2hlcyhgJHtzaXRlUm9vdH0vJHtiYXNlUGF0aH1gLCB7XG4gICAgbGVhZGluZzogZmFsc2UsXG4gIH0pfS9gXG5cbiAgaWYgKGFzc2V0c1BhdGggJiYgIWlzQWJzb2x1dGVVcmwoYXNzZXRzUGF0aCkpIHtcbiAgICBhc3NldHNQYXRoID0gYC8ke2NsZWFuU2xhc2hlcyhgJHtiYXNlUGF0aH0vJHthc3NldHNQYXRofWApfS9gXG4gIH1cblxuICAvLyBhZGQgdHJhaWxpbmcgc2xhc2ggb25seSBpZiBhc3NldHNQYXRoIHdhcyBzdXBwbGllZCwgYnV0IG5vIHRyYWlsaW5nIHNsYXNoXG4gIGlmIChhc3NldHNQYXRoICYmICFhc3NldHNQYXRoLmVuZHNXaXRoKCcvJykpIHtcbiAgICBhc3NldHNQYXRoID0gYCR7YXNzZXRzUGF0aH0vYFxuICB9XG5cbiAgLy8gQWRkIHRoZSBwcm9qZWN0IHJvb3QgYXMgYSBwbHVnaW4uIFRoaXMgYWxsb3dzIHRoZSBkZXZcbiAgLy8gdG8gdXNlIHRoZSBwbHVnaW4gYXBpIGRpcmVjdG9yeSBpbiB0aGVpciBwcm9qZWN0IGlmIHRoZXkgd2FudFxuICBjb25zdCBwbHVnaW5zID0gWy4uLihjb25maWcucGx1Z2lucyB8fCBbXSksIHBhdGhzLlJPT1RdXG5cbiAgLy8gaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAndGVzdCcgJiYgIWVudHJ5KSB7XG4gIC8vICAgdGhyb3cgbmV3IEVycm9yKFxuICAvLyAgICAgYENvdWxkIG5vdCByZXNvbHZlIGVudHJ5IGZpbGUgZnJvbSBsb2NhdGlvbjogJHtlbnRyeX0gdXNpbmcgZXh0ZW5zaW9uczogJHsoXG4gIC8vICAgICAgIGNvbmZpZy5leHRlbnNpb25zIHx8IERFRkFVTFRfRVhURU5TSU9OU1xuICAvLyAgICAgKS5qb2luKCcsICcpfWBcbiAgLy8gICApXG4gIC8vIH1cblxuICAvLyBEZWZhdWx0c1xuICBjb25maWcgPSB7XG4gICAgLy8gRGVmYXVsdHNcbiAgICBnZXRTaXRlRGF0YTogKCkgPT4gKHt9KSxcbiAgICBwcmVmZXRjaFJhdGU6IDUsXG4gICAgbWF4VGhyZWFkczogSW5maW5pdHksXG4gICAgZGlzYWJsZVJvdXRlUHJlZml4aW5nOiBmYWxzZSxcbiAgICBvdXRwdXRGaWxlUmF0ZTogMTAwLFxuICAgIGV4dGVuc2lvbnM6IERFRkFVTFRfRVhURU5TSU9OUyxcbiAgICBnZXRSb3V0ZXM6IGFzeW5jICgpID0+IERFRkFVTFRfUk9VVEVTLFxuICAgIG1pbkxvYWRUaW1lOiAyMDAsXG4gICAgZGlzYWJsZVByZWxvYWQ6IGZhbHNlLFxuICAgIGRpc2FibGVSdW50aW1lOiBmYWxzZSxcbiAgICBwcmVsb2FkUG9sbEludGVydmFsOiAzMDAsXG4gICAgcHJvZHVjdGlvblNvdXJjZU1hcHM6IGZhbHNlLFxuICAgIHNpbGVudDogZmFsc2UsXG4gICAgZW50cnk6IERFRkFVTFRfRU5UUlksXG5cbiAgICAvLyBDb25maWcgT3ZlcnJpZGVzXG4gICAgLi4uY29uZmlnLFxuXG4gICAgLy8gTWF0ZXJpYWxpemVkIE92ZXJyaWRlc1xuICAgIHBhdGhzLFxuICAgIHBsdWdpbnMsXG4gICAgc2l0ZVJvb3QsXG4gICAgYmFzZVBhdGgsXG4gICAgcHVibGljUGF0aCxcbiAgICBhc3NldHNQYXRoLFxuICAgIGV4dHJhY3RDc3NDaHVua3M6IGNvbmZpZy5leHRyYWN0Q3NzQ2h1bmtzIHx8IGZhbHNlLFxuICAgIGlubGluZUNzczogY29uZmlnLmlubGluZUNzcyB8fCBmYWxzZSxcbiAgICBiYWJlbEV4Y2x1ZGVzOiBjb25maWcuYmFiZWxFeGNsdWRlcyB8fCBbXSxcbiAgICBkZXZTZXJ2ZXI6IHtcbiAgICAgIGhvc3Q6ICdsb2NhbGhvc3QnLFxuICAgICAgcG9ydDogMzAwMCxcbiAgICAgIC4uLihjb25maWcuZGV2U2VydmVyIHx8IHt9KSxcbiAgICB9LFxuICB9XG5cbiAgY29uZmlnLnRlcnNlciA9IGNvbmZpZy50ZXJzZXIgfHwge31cbiAgY29uZmlnLnRlcnNlci50ZXJzZXJPcHRpb25zID0gY29uZmlnLnRlcnNlci50ZXJzZXJPcHRpb25zIHx8IHt9XG4gIGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucy5tYW5nbGUgPSBjb25maWcudGVyc2VyLnRlcnNlck9wdGlvbnMubWFuZ2xlIHx8IHt9XG4gIGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucy5wYXJzZSA9IGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucy5wYXJzZSB8fCB7fVxuICBjb25maWcudGVyc2VyLnRlcnNlck9wdGlvbnMuY29tcHJlc3MgPVxuICAgIGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucy5jb21wcmVzcyB8fCB7fVxuICBjb25maWcudGVyc2VyLnRlcnNlck9wdGlvbnMub3V0cHV0ID0gY29uZmlnLnRlcnNlci50ZXJzZXJPcHRpb25zLm91dHB1dCB8fCB7fVxuXG4gIC8vIFNldCBlbnYgdmFyaWFibGVzIHRvIGJlIHVzZWQgY2xpZW50IHNpZGVcbiAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX01JTl9MT0FEX1RJTUUgPSBjb25maWcubWluTG9hZFRpbWVcbiAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1BSRUZFVENIX1JBVEUgPSBjb25maWcucHJlZmV0Y2hSYXRlXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19ESVNBQkxFX1JPVVRFX1BSRUZJWElORyA9XG4gICAgY29uZmlnLmRpc2FibGVSb3V0ZVByZWZpeGluZ1xuICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfRElTQUJMRV9QUkVMT0FEID0gY29uZmlnLmRpc2FibGVQcmVsb2FkXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19ESVNBQkxFX1JVTlRJTUUgPSBjb25maWcuZGlzYWJsZVJ1bnRpbWVcbiAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1BSRUxPQURfUE9MTF9JTlRFUlZBTCA9IGNvbmZpZy5wcmVsb2FkUG9sbEludGVydmFsXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19TSUxFTlQgPSBjb25maWcuc2lsZW50XG5cbiAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1JPT1RfUEFUSF9SRUFEX09OTFkgPSBwYXRocy5ST09UXG5cbiAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1RFTVBMQVRFU19QQVRIID0gbm9kZVBhdGguam9pbihcbiAgICBwYXRocy5BUlRJRkFDVFMsXG4gICAgJ3JlYWN0LXN0YXRpYy10ZW1wbGF0ZXMuanMnXG4gIClcbiAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1BMVUdJTlNfUEFUSCA9IG5vZGVQYXRoLmpvaW4oXG4gICAgcGF0aHMuQVJUSUZBQ1RTLFxuICAgICdyZWFjdC1zdGF0aWMtYnJvd3Nlci1wbHVnaW5zLmpzJ1xuICApXG5cbiAgY29uc3QgcmVzb2x2ZVBsdWdpbiA9IG9yaWdpbmFsTG9jYXRpb24gPT4ge1xuICAgIGxldCBvcHRpb25zID0ge31cbiAgICBpZiAoQXJyYXkuaXNBcnJheShvcmlnaW5hbExvY2F0aW9uKSkge1xuICAgICAgb3B0aW9ucyA9IG9yaWdpbmFsTG9jYXRpb25bMV0gfHwge31cbiAgICAgIG9yaWdpbmFsTG9jYXRpb24gPSBvcmlnaW5hbExvY2F0aW9uWzBdXG4gICAgfVxuXG4gICAgY29uc3QgbG9jYXRpb24gPSBbXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vIEFic29sdXRlIHJlcXVpcmVcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBmb3VuZCA9IHJlcXVpcmUucmVzb2x2ZShvcmlnaW5hbExvY2F0aW9uKVxuICAgICAgICAgIHJldHVybiBmb3VuZC5pbmNsdWRlcygnLicpID8gbm9kZVBhdGgucmVzb2x2ZShmb3VuZCwgJy4uLycpIDogZm91bmRcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgLy9cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8gQWJzb2x1dGVcbiAgICAgICAgaWYgKGZzLnBhdGhFeGlzdHNTeW5jKG9yaWdpbmFsTG9jYXRpb24pKSB7XG4gICAgICAgICAgcmV0dXJuIG9yaWdpbmFsTG9jYXRpb25cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8gUGx1Z2lucyBEaXJcbiAgICAgICAgY29uc3QgZm91bmQgPSBub2RlUGF0aC5yZXNvbHZlKHBhdGhzLlBMVUdJTlMsIG9yaWdpbmFsTG9jYXRpb24pXG4gICAgICAgIGlmIChmcy5wYXRoRXhpc3RzU3luYyhmb3VuZCkpIHtcbiAgICAgICAgICByZXR1cm4gZm91bmRcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8gUGx1Z2lucyBEaXIgcmVxdWlyZVxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGZvdW5kID0gcmVzb2x2ZUZyb20ocGF0aHMuUExVR0lOUywgb3JpZ2luYWxMb2NhdGlvbilcbiAgICAgICAgICByZXR1cm4gZm91bmQuaW5jbHVkZXMoJy4nKSA/IG5vZGVQYXRoLnJlc29sdmUoZm91bmQsICcuLi8nKSA6IGZvdW5kXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vIENXRFxuICAgICAgICBjb25zdCBmb3VuZCA9IG5vZGVQYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSwgb3JpZ2luYWxMb2NhdGlvbilcbiAgICAgICAgaWYgKGZzLnBhdGhFeGlzdHNTeW5jKGZvdW5kKSkge1xuICAgICAgICAgIHJldHVybiBmb3VuZFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgKCkgPT4ge1xuICAgICAgICAvLyBDV0QgcmVxdWlyZVxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGZvdW5kID0gcmVzb2x2ZUZyb20ocHJvY2Vzcy5jd2QoKSwgb3JpZ2luYWxMb2NhdGlvbilcbiAgICAgICAgICByZXR1cm4gZm91bmQuaW5jbHVkZXMoJy4nKSA/IG5vZGVQYXRoLnJlc29sdmUoZm91bmQsICcuLi8nKSA6IGZvdW5kXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnKSB7XG4gICAgICAgICAgLy8gQWxsb3cgcGx1Z2lucyB0byBiZSBtb2NrZWRcbiAgICAgICAgICByZXR1cm4gcmVxdWlyZSgncGF0aCcpLnJlc29sdmUoJy4vc3JjL3N0YXRpYy9fX21vY2tzX18vbW9jay1wbHVnaW4nKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgIF0ucmVkdWNlKChwcmV2LCBjdXJyKSA9PiBwcmV2IHx8IGN1cnIoKSwgbnVsbClcblxuICAgIC8vIFRPRE86IFdlIGhhdmUgdG8gZG8gdGhpcyBiZWNhdXNlIHdlIGRvbid0IGhhdmUgYSBnb29kIG1vY2sgZm9yIHByb2Nlc3MuY3dkKCkgOihcbiAgICBpZiAoIWxvY2F0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDb3VsZCBub3QgZmluZCBhIHBsdWdpbiBkaXJlY3RvcnkgZm9yIHRoZSBwbHVnaW46IFwiJHtvcmlnaW5hbExvY2F0aW9ufVwiLiBXZSBtdXN0IGJhaWwhYFxuICAgICAgKVxuICAgIH1cblxuICAgIGxldCBub2RlTG9jYXRpb24gPSBub2RlUGF0aC5qb2luKGxvY2F0aW9uLCAnbm9kZS5hcGkuanMnKVxuICAgIGxldCBicm93c2VyTG9jYXRpb24gPSBub2RlUGF0aC5qb2luKGxvY2F0aW9uLCAnYnJvd3Nlci5hcGkuanMnKVxuXG4gICAgLy8gRGV0ZWN0IGlmIHRoZSBub2RlIHBsdWdpbiBlbnRyeSBleGlzdHMsIGFuZCBwcm92aWRlIHRoZSBub2RlUmVzb2x2ZXIgdG8gaXRcbiAgICBub2RlTG9jYXRpb24gPSBmcy5wYXRoRXhpc3RzU3luYyhub2RlTG9jYXRpb24pID8gbm9kZUxvY2F0aW9uIDogbnVsbFxuXG4gICAgLy8gRGV0ZWN0IGlmIHRoZSBicm93c2VyIHBsdWdpbiBlbnRyeSBleGlzdHMsIGFuZCBwcm92aWRlIHRoZSBub2RlUmVzb2x2ZXIgdG8gaXRcbiAgICBicm93c2VyTG9jYXRpb24gPSBmcy5wYXRoRXhpc3RzU3luYyhicm93c2VyTG9jYXRpb24pXG4gICAgICA/IGJyb3dzZXJMb2NhdGlvblxuICAgICAgOiBudWxsXG5cbiAgICBsZXQgYnVpbGRQbHVnaW5Ib29rcyA9ICgpID0+ICh7fSlcblxuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgdGhlIGhvb2tzIGZvciB0aGUgbm9kZSBhcGlcbiAgICAgIGlmIChub2RlTG9jYXRpb24pIHtcbiAgICAgICAgYnVpbGRQbHVnaW5Ib29rcyA9IHJlcXVpcmUobm9kZUxvY2F0aW9uKS5kZWZhdWx0XG4gICAgICB9IGVsc2UgaWYgKG9yaWdpbmFsTG9jYXRpb24gIT09IHBhdGhzLlJPT1QgJiYgIWJyb3dzZXJMb2NhdGlvbikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYENvdWxkIG5vdCBmaW5kIGEgdmFsaWQgbm9kZS5hcGkuanMgb3IgYnJvd3Nlci5hcGkuanMgcGx1Z2luIGZpbGUgaW4gXCIke2xvY2F0aW9ufVwiLiBcXG5gICtcbiAgICAgICAgICAgIGBUaGUgb3JpZ2luYWwgbG9jYXRpb246IFwiJHtvcmlnaW5hbExvY2F0aW9ufVwiLiBcXG5gICtcbiAgICAgICAgICAgIGBUaGUgcm9vdCBsb2NhdGlvbjogXCIke3BhdGhzLlJPT1R9XCIuYFxuICAgICAgICApXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc29sdmVkUGx1Z2luID0ge1xuICAgICAgICBsb2NhdGlvbixcbiAgICAgICAgbm9kZUxvY2F0aW9uLFxuICAgICAgICBicm93c2VyTG9jYXRpb24sXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGhvb2tzOiBidWlsZFBsdWdpbkhvb2tzKG9wdGlvbnMpIHx8IHt9LFxuICAgICAgfVxuXG4gICAgICB2YWxpZGF0ZVBsdWdpbihyZXNvbHZlZFBsdWdpbilcblxuICAgICAgLy8gUmVjdXJzaXZlbHkgcmVzb2x2ZSBwbHVnaW5zXG4gICAgICBpZiAocmVzb2x2ZWRQbHVnaW4ucGx1Z2lucykge1xuICAgICAgICByZXNvbHZlZFBsdWdpbi5wbHVnaW5zID0gcmVzb2x2ZWRQbHVnaW4ucGx1Z2lucy5tYXAocmVzb2x2ZVBsdWdpbilcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc29sdmVkUGx1Z2luXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICBgVGhlIGZvbGxvd2luZyBlcnJvciBvY2N1cnJlZCBpbiB0aGUgcGx1Z2luOiBcIiR7b3JpZ2luYWxMb2NhdGlvbn1cImBcbiAgICAgIClcbiAgICAgIHRocm93IGVyclxuICAgIH1cbiAgfVxuXG4gIHN0YXRlID0ge1xuICAgIC4uLnN0YXRlLFxuICAgIHBsdWdpbnM6IGNvbmZpZy5wbHVnaW5zLm1hcChyZXNvbHZlUGx1Z2luKSxcbiAgICBjb25maWcsXG4gIH1cblxuICByZXR1cm4gY29yZVBsdWdpbnMuYWZ0ZXJHZXRDb25maWcoc3RhdGUpXG59XG4iXX0=