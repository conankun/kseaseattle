"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.pathJoin = pathJoin;
exports.getRoutePath = getRoutePath;
exports.getCurrentRoutePath = getCurrentRoutePath;
exports.unwrapArray = unwrapArray;
exports.isObject = isObject;
exports.deprecate = deprecate;
exports.removal = removal;
exports.isAbsoluteUrl = isAbsoluteUrl;
exports.makePathAbsolute = makePathAbsolute;
exports.reduceHooks = reduceHooks;
exports.mapHooks = mapHooks;
exports.getHooks = getHooks;
exports.getFullRouteData = getFullRouteData;
exports.is404Path = is404Path;
Object.defineProperty(exports, "poolAll", {
  enumerable: true,
  get: function get() {
    return _swimmer.poolAll;
  }
});
Object.defineProperty(exports, "createPool", {
  enumerable: true,
  get: function get() {
    return _swimmer.createPool;
  }
});
exports.PATH_404 = exports.cleanSlashes = exports.trimDoubleSlashes = exports.trimTrailingSlashes = exports.trimLeadingSlashes = exports.cutPathToRoot = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _swimmer = require("swimmer");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var REGEX_TO_CUT_TO_ROOT = /(\..+?)\/.*/g;
var REGEX_TO_REMOVE_LEADING_SLASH = /^\/{1,}/g;
var REGEX_TO_REMOVE_TRAILING_SLASH = /\/{1,}$/g;
var REGEX_TO_REMOVE_DOUBLE_SLASH = /\/{2,}/g;

var cutPathToRoot = function cutPathToRoot() {
  var string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
  return string.replace(REGEX_TO_CUT_TO_ROOT, '$1');
};

exports.cutPathToRoot = cutPathToRoot;

var trimLeadingSlashes = function trimLeadingSlashes() {
  var string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
  return string.replace(REGEX_TO_REMOVE_LEADING_SLASH, '');
};

exports.trimLeadingSlashes = trimLeadingSlashes;

var trimTrailingSlashes = function trimTrailingSlashes() {
  var string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
  return string.replace(REGEX_TO_REMOVE_TRAILING_SLASH, '');
};

exports.trimTrailingSlashes = trimTrailingSlashes;

var trimDoubleSlashes = function trimDoubleSlashes() {
  var string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';

  if (isAbsoluteUrl(string)) {
    var _string$split = string.split('://'),
        _string$split2 = (0, _slicedToArray2["default"])(_string$split, 2),
        _string$split2$ = _string$split2[0],
        scheme = _string$split2$ === void 0 ? '' : _string$split2$,
        _string$split2$2 = _string$split2[1],
        path = _string$split2$2 === void 0 ? '' : _string$split2$2;

    return [scheme, path.replace(REGEX_TO_REMOVE_DOUBLE_SLASH, '/')].join('://');
  }

  return string.replace(REGEX_TO_REMOVE_DOUBLE_SLASH, '/');
};

exports.trimDoubleSlashes = trimDoubleSlashes;

var cleanSlashes = function cleanSlashes(string) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  if (!string) return '';

  var _options$leading = options.leading,
      leading = _options$leading === void 0 ? true : _options$leading,
      _options$trailing = options.trailing,
      trailing = _options$trailing === void 0 ? true : _options$trailing,
      _options$double = options["double"],
      _double = _options$double === void 0 ? true : _options$double;

  var cleanedString = string;

  if (leading) {
    cleanedString = trimLeadingSlashes(cleanedString);
  }

  if (trailing) {
    cleanedString = trimTrailingSlashes(cleanedString);
  }

  if (_double) {
    cleanedString = trimDoubleSlashes(cleanedString);
  }

  return cleanedString;
};

exports.cleanSlashes = cleanSlashes;

function pathJoin() {
  for (var _len = arguments.length, paths = new Array(_len), _key = 0; _key < _len; _key++) {
    paths[_key] = arguments[_key];
  }

  var newPath = paths.map(cleanSlashes).join('/');

  if (!newPath || newPath === '/') {
    return '/';
  }

  newPath = cleanSlashes(newPath);

  if (newPath.includes('?')) {
    newPath = newPath.substring(0, newPath.indexOf('?'));
  }

  return newPath;
} // This function is for extracting a routePath from a path or string
// RoutePaths do not have query params, basePaths, and should
// resemble the same string as passed in the static.config.js routes


function getRoutePath(routePath) {
  // Detect falsey paths and the root path
  if (!routePath || routePath === '/' || routePath === process.env.REACT_STATIC_BASE_PATH) {
    return '/';
  } // Remove origin, hashes, and query params


  if (typeof document !== 'undefined') {
    routePath = routePath.replace(window.location.origin, '');
    routePath = routePath.replace(/#.*/, '');
    routePath = routePath.replace(/\?.*/, '');
  } // Be sure to remove the base path


  if (process.env.REACT_STATIC_BASE_PATH) {
    routePath = routePath.replace(new RegExp("^\\/?".concat(process.env.REACT_STATIC_BASE_PATH, "(\\/|$)")), '');
  }

  routePath = routePath || '/';
  return pathJoin(routePath);
}

function getCurrentRoutePath() {
  // If in the browser, use the window
  if (typeof document !== 'undefined') {
    return getRoutePath(decodeURIComponent(window.location.href));
  }
}

function unwrapArray(arg, defaultValue) {
  arg = Array.isArray(arg) ? arg[0] : arg;

  if (!arg && defaultValue) {
    return defaultValue;
  }

  return arg;
}

function isObject(a) {
  return !Array.isArray(a) && (0, _typeof2["default"])(a) === 'object' && a !== null;
}

function deprecate(from, to) {
  console.warn("React-Static deprecation notice: ".concat(from, " will be deprecated in favor of ").concat(to, " in the next major release."));
}

function removal(from) {
  console.warn("React-Static removal notice: ".concat(from, " is no longer supported in this version of React-Static. Please refer to the CHANGELOG for details."));
}

function isAbsoluteUrl(url) {
  if (typeof url !== 'string') {
    return false;
  }

  return /^[a-z][a-z0-9+.-]*:/.test(url);
}

function makePathAbsolute(path) {
  if (typeof path !== 'string') {
    return '/';
  }

  if (isAbsoluteUrl(path)) {
    return path;
  }

  return "/".concat(trimLeadingSlashes(path));
}

function reduceHooks(hooks) {
  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
      sync = _ref.sync;

  // These returns a runner that takes a value (and options) and
  // reduces the value through each hook, returning the
  // final value
  // compare is a function which is used to compare
  // the prev and next value and decide which to use.
  // By default, if undefined is returned from a reducer, the prev value
  // is retained
  // If synchronous, things are simple
  if (sync) {
    return function (value, options) {
      return hooks.reduce(function (prev, hook) {
        var next = hook(prev, options);

        if (next instanceof Promise) {
          throw new Error('Expected hook to return a value, but received promise instead. A plugin is attempting to use a sync plugin with an async function!');
        }

        return typeof next !== 'undefined' ? next : prev;
      }, value);
    };
  } // We create a map of hook handlers that point to the next hook
  // in line and reduce the value throughout (or return it if it's done)


  return function (startValue, options) {
    var hookList = hooks.map(function (hook, index) {
      return (
        /*#__PURE__*/
        function () {
          var _ref2 = (0, _asyncToGenerator2["default"])(
          /*#__PURE__*/
          _regenerator["default"].mark(function _callee(lastValue) {
            var nextValue;
            return _regenerator["default"].wrap(function _callee$(_context) {
              while (1) {
                switch (_context.prev = _context.next) {
                  case 0:
                    _context.next = 2;
                    return hook(lastValue, options);

                  case 2:
                    nextValue = _context.sent;
                    nextValue = typeof nextValue !== 'undefined' ? nextValue : lastValue;

                    if (!hookList[index + 1]) {
                      _context.next = 6;
                      break;
                    }

                    return _context.abrupt("return", hookList[index + 1](nextValue));

                  case 6:
                    return _context.abrupt("return", nextValue);

                  case 7:
                  case "end":
                    return _context.stop();
                }
              }
            }, _callee);
          }));

          return function (_x) {
            return _ref2.apply(this, arguments);
          };
        }()
      );
    });
    return hookList.length ? hookList[0](startValue) : startValue;
  };
}

function mapHooks(hooks) {
  var _ref3 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
      sync = _ref3.sync;

  // Returns a function that takes state and returns
  // a flat array of values mapped from each hook
  if (sync) {
    return function (state) {
      var results = hooks.map(function (hook) {
        return hook(state);
      });
      return results.filter(function (d) {
        return typeof d !== 'undefined';
      });
    };
  }

  return function (state) {
    var results = [];
    var hookList = hooks.map(function (hook, index) {
      return (
        /*#__PURE__*/
        (0, _asyncToGenerator2["default"])(
        /*#__PURE__*/
        _regenerator["default"].mark(function _callee2() {
          return _regenerator["default"].wrap(function _callee2$(_context2) {
            while (1) {
              switch (_context2.prev = _context2.next) {
                case 0:
                  _context2.next = 2;
                  return hook(state);

                case 2:
                  results[index] = _context2.sent;

                  if (!hookList[index + 1]) {
                    _context2.next = 5;
                    break;
                  }

                  return _context2.abrupt("return", hookList[index + 1]());

                case 5:
                  return _context2.abrupt("return", results.filter(function (d) {
                    return typeof d !== 'undefined';
                  }));

                case 6:
                case "end":
                  return _context2.stop();
              }
            }
          }, _callee2);
        }))
      );
    });
    return hookList.length ? hookList[0]() : [];
  };
}

function getHooks(plugins, hook) {
  if (!hook) {
    throw new Error('A hook ID is required!');
  } // The flat hooks


  var hooks = []; // Adds a plugin hook to the hook list

  var addToHooks = function addToHooks(plugin) {
    // Add the hook
    hooks.push(plugin.hooks[hook]); // Recurse into sub plugins if needs be

    if (plugin.plugins) {
      plugin.plugins.forEach(addToHooks);
    }
  }; // Start with the config plugins


  plugins.forEach(addToHooks); // Filter out falsey entries

  return hooks.filter(Boolean);
}

function getFullRouteData(routeInfo) {
  return _objectSpread({}, routeInfo.sharedData ? routeInfo.sharedData : {}, {}, routeInfo.data);
}

var PATH_404 = '404';
exports.PATH_404 = PATH_404;

function is404Path(path) {
  return path === PATH_404;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9icm93c2VyL3V0aWxzL2luZGV4LmpzIl0sIm5hbWVzIjpbIlJFR0VYX1RPX0NVVF9UT19ST09UIiwiUkVHRVhfVE9fUkVNT1ZFX0xFQURJTkdfU0xBU0giLCJSRUdFWF9UT19SRU1PVkVfVFJBSUxJTkdfU0xBU0giLCJSRUdFWF9UT19SRU1PVkVfRE9VQkxFX1NMQVNIIiwiY3V0UGF0aFRvUm9vdCIsInN0cmluZyIsInJlcGxhY2UiLCJ0cmltTGVhZGluZ1NsYXNoZXMiLCJ0cmltVHJhaWxpbmdTbGFzaGVzIiwidHJpbURvdWJsZVNsYXNoZXMiLCJpc0Fic29sdXRlVXJsIiwic3BsaXQiLCJzY2hlbWUiLCJwYXRoIiwiam9pbiIsImNsZWFuU2xhc2hlcyIsIm9wdGlvbnMiLCJsZWFkaW5nIiwidHJhaWxpbmciLCJkb3VibGUiLCJjbGVhbmVkU3RyaW5nIiwicGF0aEpvaW4iLCJwYXRocyIsIm5ld1BhdGgiLCJtYXAiLCJpbmNsdWRlcyIsInN1YnN0cmluZyIsImluZGV4T2YiLCJnZXRSb3V0ZVBhdGgiLCJyb3V0ZVBhdGgiLCJwcm9jZXNzIiwiZW52IiwiUkVBQ1RfU1RBVElDX0JBU0VfUEFUSCIsImRvY3VtZW50Iiwid2luZG93IiwibG9jYXRpb24iLCJvcmlnaW4iLCJSZWdFeHAiLCJnZXRDdXJyZW50Um91dGVQYXRoIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiaHJlZiIsInVud3JhcEFycmF5IiwiYXJnIiwiZGVmYXVsdFZhbHVlIiwiQXJyYXkiLCJpc0FycmF5IiwiaXNPYmplY3QiLCJhIiwiZGVwcmVjYXRlIiwiZnJvbSIsInRvIiwiY29uc29sZSIsIndhcm4iLCJyZW1vdmFsIiwidXJsIiwidGVzdCIsIm1ha2VQYXRoQWJzb2x1dGUiLCJyZWR1Y2VIb29rcyIsImhvb2tzIiwic3luYyIsInZhbHVlIiwicmVkdWNlIiwicHJldiIsImhvb2siLCJuZXh0IiwiUHJvbWlzZSIsIkVycm9yIiwic3RhcnRWYWx1ZSIsImhvb2tMaXN0IiwiaW5kZXgiLCJsYXN0VmFsdWUiLCJuZXh0VmFsdWUiLCJsZW5ndGgiLCJtYXBIb29rcyIsInN0YXRlIiwicmVzdWx0cyIsImZpbHRlciIsImQiLCJnZXRIb29rcyIsInBsdWdpbnMiLCJhZGRUb0hvb2tzIiwicGx1Z2luIiwicHVzaCIsImZvckVhY2giLCJCb29sZWFuIiwiZ2V0RnVsbFJvdXRlRGF0YSIsInJvdXRlSW5mbyIsInNoYXJlZERhdGEiLCJkYXRhIiwiUEFUSF80MDQiLCJpczQwNFBhdGgiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7QUFFQSxJQUFNQSxvQkFBb0IsR0FBRyxjQUE3QjtBQUNBLElBQU1DLDZCQUE2QixHQUFHLFVBQXRDO0FBQ0EsSUFBTUMsOEJBQThCLEdBQUcsVUFBdkM7QUFDQSxJQUFNQyw0QkFBNEIsR0FBRyxTQUFyQzs7QUFFTyxJQUFNQyxhQUFhLEdBQUcsU0FBaEJBLGFBQWdCO0FBQUEsTUFBQ0MsTUFBRCx1RUFBVSxFQUFWO0FBQUEsU0FDM0JBLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlTixvQkFBZixFQUFxQyxJQUFyQyxDQUQyQjtBQUFBLENBQXRCOzs7O0FBR0EsSUFBTU8sa0JBQWtCLEdBQUcsU0FBckJBLGtCQUFxQjtBQUFBLE1BQUNGLE1BQUQsdUVBQVUsRUFBVjtBQUFBLFNBQ2hDQSxNQUFNLENBQUNDLE9BQVAsQ0FBZUwsNkJBQWYsRUFBOEMsRUFBOUMsQ0FEZ0M7QUFBQSxDQUEzQjs7OztBQUdBLElBQU1PLG1CQUFtQixHQUFHLFNBQXRCQSxtQkFBc0I7QUFBQSxNQUFDSCxNQUFELHVFQUFVLEVBQVY7QUFBQSxTQUNqQ0EsTUFBTSxDQUFDQyxPQUFQLENBQWVKLDhCQUFmLEVBQStDLEVBQS9DLENBRGlDO0FBQUEsQ0FBNUI7Ozs7QUFHQSxJQUFNTyxpQkFBaUIsR0FBRyxTQUFwQkEsaUJBQW9CLEdBQWlCO0FBQUEsTUFBaEJKLE1BQWdCLHVFQUFQLEVBQU87O0FBQ2hELE1B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RyxFQUFkLENBTHNDLENBT3RDOztBQUNBLE1BQU1zQixVQUFVLEdBQUcsU0FBYkEsVUFBYSxDQUFBQyxNQUFNLEVBQUk7QUFDM0I7QUFDQXZCLElBQUFBLEtBQUssQ0FBQ3dCLElBQU4sQ0FBV0QsTUFBTSxDQUFDdkIsS0FBUCxDQUFhSyxJQUFiLENBQVgsRUFGMkIsQ0FJM0I7O0FBQ0EsUUFBSWtCLE1BQU0sQ0FBQ0YsT0FBWCxFQUFvQjtBQUNsQkUsTUFBQUEsTUFBTSxDQUFDRixPQUFQLENBQWVJLE9BQWYsQ0FBdUJILFVBQXZCO0FBQ0Q7QUFDRixHQVJELENBUnNDLENBaUJ0Qzs7O0FBQ0FELEVBQUFBLE9BQU8sQ0FBQ0ksT0FBUixDQUFnQkgsVUFBaEIsRUFsQnNDLENBb0J0Qzs7QUFDQSxTQUFPdEIsS0FBSyxDQUFDa0IsTUFBTixDQUFhUSxPQUFiLENBQVA7QUFDRDs7QUFFTSxTQUFTQyxnQkFBVCxDQUEwQkMsU0FBMUIsRUFBcUM7QUFDMUMsMkJBQ01BLFNBQVMsQ0FBQ0MsVUFBVixHQUF1QkQsU0FBUyxDQUFDQyxVQUFqQyxHQUE4QyxFQURwRCxNQUVLRCxTQUFTLENBQUNFLElBRmY7QUFJRDs7QUFFTSxJQUFNQyxRQUFRLEdBQUcsS0FBakI7OztBQUVBLFNBQVNDLFNBQVQsQ0FBbUI3RSxJQUFuQixFQUF5QjtBQUM5QixTQUFPQSxJQUFJLEtBQUs0RSxRQUFoQjtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHsgcG9vbEFsbCwgY3JlYXRlUG9vbCB9IGZyb20gJ3N3aW1tZXInXG5cbmNvbnN0IFJFR0VYX1RPX0NVVF9UT19ST09UID0gLyhcXC4uKz8pXFwvLiovZ1xuY29uc3QgUkVHRVhfVE9fUkVNT1ZFX0xFQURJTkdfU0xBU0ggPSAvXlxcL3sxLH0vZ1xuY29uc3QgUkVHRVhfVE9fUkVNT1ZFX1RSQUlMSU5HX1NMQVNIID0gL1xcL3sxLH0kL2dcbmNvbnN0IFJFR0VYX1RPX1JFTU9WRV9ET1VCTEVfU0xBU0ggPSAvXFwvezIsfS9nXG5cbmV4cG9ydCBjb25zdCBjdXRQYXRoVG9Sb290ID0gKHN0cmluZyA9ICcnKSA9PlxuICBzdHJpbmcucmVwbGFjZShSRUdFWF9UT19DVVRfVE9fUk9PVCwgJyQxJylcblxuZXhwb3J0IGNvbnN0IHRyaW1MZWFkaW5nU2xhc2hlcyA9IChzdHJpbmcgPSAnJykgPT5cbiAgc3RyaW5nLnJlcGxhY2UoUkVHRVhfVE9fUkVNT1ZFX0xFQURJTkdfU0xBU0gsICcnKVxuXG5leHBvcnQgY29uc3QgdHJpbVRyYWlsaW5nU2xhc2hlcyA9IChzdHJpbmcgPSAnJykgPT5cbiAgc3RyaW5nLnJlcGxhY2UoUkVHRVhfVE9fUkVNT1ZFX1RSQUlMSU5HX1NMQVNILCAnJylcblxuZXhwb3J0IGNvbnN0IHRyaW1Eb3VibGVTbGFzaGVzID0gKHN0cmluZyA9ICcnKSA9PiB7XG4gIGlmIChpc0Fic29sdXRlVXJsKHN0cmluZykpIHtcbiAgICBjb25zdCBbc2NoZW1lID0gJycsIHBhdGggPSAnJ10gPSBzdHJpbmcuc3BsaXQoJzovLycpXG5cbiAgICByZXR1cm4gW3NjaGVtZSwgcGF0aC5yZXBsYWNlKFJFR0VYX1RPX1JFTU9WRV9ET1VCTEVfU0xBU0gsICcvJyldLmpvaW4oJzovLycpXG4gIH1cblxuICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoUkVHRVhfVE9fUkVNT1ZFX0RPVUJMRV9TTEFTSCwgJy8nKVxufVxuXG5leHBvcnQgY29uc3QgY2xlYW5TbGFzaGVzID0gKHN0cmluZywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGlmICghc3RyaW5nKSByZXR1cm4gJydcblxuICBjb25zdCB7IGxlYWRpbmcgPSB0cnVlLCB0cmFpbGluZyA9IHRydWUsIGRvdWJsZSA9IHRydWUgfSA9IG9wdGlvbnNcbiAgbGV0IGNsZWFuZWRTdHJpbmcgPSBzdHJpbmdcblxuICBpZiAobGVhZGluZykge1xuICAgIGNsZWFuZWRTdHJpbmcgPSB0cmltTGVhZGluZ1NsYXNoZXMoY2xlYW5lZFN0cmluZylcbiAgfVxuXG4gIGlmICh0cmFpbGluZykge1xuICAgIGNsZWFuZWRTdHJpbmcgPSB0cmltVHJhaWxpbmdTbGFzaGVzKGNsZWFuZWRTdHJpbmcpXG4gIH1cblxuICBpZiAoZG91YmxlKSB7XG4gICAgY2xlYW5lZFN0cmluZyA9IHRyaW1Eb3VibGVTbGFzaGVzKGNsZWFuZWRTdHJpbmcpXG4gIH1cblxuICByZXR1cm4gY2xlYW5lZFN0cmluZ1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGF0aEpvaW4oLi4ucGF0aHMpIHtcbiAgbGV0IG5ld1BhdGggPSBwYXRocy5tYXAoY2xlYW5TbGFzaGVzKS5qb2luKCcvJylcbiAgaWYgKCFuZXdQYXRoIHx8IG5ld1BhdGggPT09ICcvJykge1xuICAgIHJldHVybiAnLydcbiAgfVxuXG4gIG5ld1BhdGggPSBjbGVhblNsYXNoZXMobmV3UGF0aClcbiAgaWYgKG5ld1BhdGguaW5jbHVkZXMoJz8nKSkge1xuICAgIG5ld1BhdGggPSBuZXdQYXRoLnN1YnN0cmluZygwLCBuZXdQYXRoLmluZGV4T2YoJz8nKSlcbiAgfVxuICByZXR1cm4gbmV3UGF0aFxufVxuXG4vLyBUaGlzIGZ1bmN0aW9uIGlzIGZvciBleHRyYWN0aW5nIGEgcm91dGVQYXRoIGZyb20gYSBwYXRoIG9yIHN0cmluZ1xuLy8gUm91dGVQYXRocyBkbyBub3QgaGF2ZSBxdWVyeSBwYXJhbXMsIGJhc2VQYXRocywgYW5kIHNob3VsZFxuLy8gcmVzZW1ibGUgdGhlIHNhbWUgc3RyaW5nIGFzIHBhc3NlZCBpbiB0aGUgc3RhdGljLmNvbmZpZy5qcyByb3V0ZXNcbmV4cG9ydCBmdW5jdGlvbiBnZXRSb3V0ZVBhdGgocm91dGVQYXRoKSB7XG4gIC8vIERldGVjdCBmYWxzZXkgcGF0aHMgYW5kIHRoZSByb290IHBhdGhcbiAgaWYgKFxuICAgICFyb3V0ZVBhdGggfHxcbiAgICByb3V0ZVBhdGggPT09ICcvJyB8fFxuICAgIHJvdXRlUGF0aCA9PT0gcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX0JBU0VfUEFUSFxuICApIHtcbiAgICByZXR1cm4gJy8nXG4gIH1cblxuICAvLyBSZW1vdmUgb3JpZ2luLCBoYXNoZXMsIGFuZCBxdWVyeSBwYXJhbXNcbiAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByb3V0ZVBhdGggPSByb3V0ZVBhdGgucmVwbGFjZSh3aW5kb3cubG9jYXRpb24ub3JpZ2luLCAnJylcbiAgICByb3V0ZVBhdGggPSByb3V0ZVBhdGgucmVwbGFjZSgvIy4qLywgJycpXG4gICAgcm91dGVQYXRoID0gcm91dGVQYXRoLnJlcGxhY2UoL1xcPy4qLywgJycpXG4gIH1cblxuICAvLyBCZSBzdXJlIHRvIHJlbW92ZSB0aGUgYmFzZSBwYXRoXG4gIGlmIChwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfQkFTRV9QQVRIKSB7XG4gICAgcm91dGVQYXRoID0gcm91dGVQYXRoLnJlcGxhY2UoXG4gICAgICBuZXcgUmVnRXhwKGBeXFxcXC8/JHtwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfQkFTRV9QQVRIfShcXFxcL3wkKWApLFxuICAgICAgJydcbiAgICApXG4gIH1cbiAgcm91dGVQYXRoID0gcm91dGVQYXRoIHx8ICcvJ1xuICByZXR1cm4gcGF0aEpvaW4ocm91dGVQYXRoKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q3VycmVudFJvdXRlUGF0aCgpIHtcbiAgLy8gSWYgaW4gdGhlIGJyb3dzZXIsIHVzZSB0aGUgd2luZG93XG4gIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIGdldFJvdXRlUGF0aChkZWNvZGVVUklDb21wb25lbnQod2luZG93LmxvY2F0aW9uLmhyZWYpKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1bndyYXBBcnJheShhcmcsIGRlZmF1bHRWYWx1ZSkge1xuICBhcmcgPSBBcnJheS5pc0FycmF5KGFyZykgPyBhcmdbMF0gOiBhcmdcbiAgaWYgKCFhcmcgJiYgZGVmYXVsdFZhbHVlKSB7XG4gICAgcmV0dXJuIGRlZmF1bHRWYWx1ZVxuICB9XG4gIHJldHVybiBhcmdcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzT2JqZWN0KGEpIHtcbiAgcmV0dXJuICFBcnJheS5pc0FycmF5KGEpICYmIHR5cGVvZiBhID09PSAnb2JqZWN0JyAmJiBhICE9PSBudWxsXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXByZWNhdGUoZnJvbSwgdG8pIHtcbiAgY29uc29sZS53YXJuKFxuICAgIGBSZWFjdC1TdGF0aWMgZGVwcmVjYXRpb24gbm90aWNlOiAke2Zyb219IHdpbGwgYmUgZGVwcmVjYXRlZCBpbiBmYXZvciBvZiAke3RvfSBpbiB0aGUgbmV4dCBtYWpvciByZWxlYXNlLmBcbiAgKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZhbChmcm9tKSB7XG4gIGNvbnNvbGUud2FybihcbiAgICBgUmVhY3QtU3RhdGljIHJlbW92YWwgbm90aWNlOiAke2Zyb219IGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQgaW4gdGhpcyB2ZXJzaW9uIG9mIFJlYWN0LVN0YXRpYy4gUGxlYXNlIHJlZmVyIHRvIHRoZSBDSEFOR0VMT0cgZm9yIGRldGFpbHMuYFxuICApXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0Fic29sdXRlVXJsKHVybCkge1xuICBpZiAodHlwZW9mIHVybCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIHJldHVybiAvXlthLXpdW2EtejAtOSsuLV0qOi8udGVzdCh1cmwpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlUGF0aEFic29sdXRlKHBhdGgpIHtcbiAgaWYgKHR5cGVvZiBwYXRoICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiAnLydcbiAgfVxuXG4gIGlmIChpc0Fic29sdXRlVXJsKHBhdGgpKSB7XG4gICAgcmV0dXJuIHBhdGhcbiAgfVxuXG4gIHJldHVybiBgLyR7dHJpbUxlYWRpbmdTbGFzaGVzKHBhdGgpfWBcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlZHVjZUhvb2tzKGhvb2tzLCB7IHN5bmMgfSA9IHt9KSB7XG4gIC8vIFRoZXNlIHJldHVybnMgYSBydW5uZXIgdGhhdCB0YWtlcyBhIHZhbHVlIChhbmQgb3B0aW9ucykgYW5kXG4gIC8vIHJlZHVjZXMgdGhlIHZhbHVlIHRocm91Z2ggZWFjaCBob29rLCByZXR1cm5pbmcgdGhlXG4gIC8vIGZpbmFsIHZhbHVlXG4gIC8vIGNvbXBhcmUgaXMgYSBmdW5jdGlvbiB3aGljaCBpcyB1c2VkIHRvIGNvbXBhcmVcbiAgLy8gdGhlIHByZXYgYW5kIG5leHQgdmFsdWUgYW5kIGRlY2lkZSB3aGljaCB0byB1c2UuXG4gIC8vIEJ5IGRlZmF1bHQsIGlmIHVuZGVmaW5lZCBpcyByZXR1cm5lZCBmcm9tIGEgcmVkdWNlciwgdGhlIHByZXYgdmFsdWVcbiAgLy8gaXMgcmV0YWluZWRcblxuICAvLyBJZiBzeW5jaHJvbm91cywgdGhpbmdzIGFyZSBzaW1wbGVcbiAgaWYgKHN5bmMpIHtcbiAgICByZXR1cm4gKHZhbHVlLCBvcHRpb25zKSA9PlxuICAgICAgaG9va3MucmVkdWNlKChwcmV2LCBob29rKSA9PiB7XG4gICAgICAgIGNvbnN0IG5leHQgPSBob29rKHByZXYsIG9wdGlvbnMpXG4gICAgICAgIGlmIChuZXh0IGluc3RhbmNlb2YgUHJvbWlzZSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICdFeHBlY3RlZCBob29rIHRvIHJldHVybiBhIHZhbHVlLCBidXQgcmVjZWl2ZWQgcHJvbWlzZSBpbnN0ZWFkLiBBIHBsdWdpbiBpcyBhdHRlbXB0aW5nIHRvIHVzZSBhIHN5bmMgcGx1Z2luIHdpdGggYW4gYXN5bmMgZnVuY3Rpb24hJ1xuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHlwZW9mIG5leHQgIT09ICd1bmRlZmluZWQnID8gbmV4dCA6IHByZXZcbiAgICAgIH0sIHZhbHVlKVxuICB9XG5cbiAgLy8gV2UgY3JlYXRlIGEgbWFwIG9mIGhvb2sgaGFuZGxlcnMgdGhhdCBwb2ludCB0byB0aGUgbmV4dCBob29rXG4gIC8vIGluIGxpbmUgYW5kIHJlZHVjZSB0aGUgdmFsdWUgdGhyb3VnaG91dCAob3IgcmV0dXJuIGl0IGlmIGl0J3MgZG9uZSlcbiAgcmV0dXJuIChzdGFydFZhbHVlLCBvcHRpb25zKSA9PiB7XG4gICAgY29uc3QgaG9va0xpc3QgPSBob29rcy5tYXAoKGhvb2ssIGluZGV4KSA9PiBhc3luYyBsYXN0VmFsdWUgPT4ge1xuICAgICAgbGV0IG5leHRWYWx1ZSA9IGF3YWl0IGhvb2sobGFzdFZhbHVlLCBvcHRpb25zKVxuICAgICAgbmV4dFZhbHVlID0gdHlwZW9mIG5leHRWYWx1ZSAhPT0gJ3VuZGVmaW5lZCcgPyBuZXh0VmFsdWUgOiBsYXN0VmFsdWVcbiAgICAgIGlmIChob29rTGlzdFtpbmRleCArIDFdKSB7XG4gICAgICAgIHJldHVybiBob29rTGlzdFtpbmRleCArIDFdKG5leHRWYWx1ZSlcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXh0VmFsdWVcbiAgICB9KVxuICAgIHJldHVybiBob29rTGlzdC5sZW5ndGggPyBob29rTGlzdFswXShzdGFydFZhbHVlKSA6IHN0YXJ0VmFsdWVcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFwSG9va3MoaG9va3MsIHsgc3luYyB9ID0ge30pIHtcbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgc3RhdGUgYW5kIHJldHVybnNcbiAgLy8gYSBmbGF0IGFycmF5IG9mIHZhbHVlcyBtYXBwZWQgZnJvbSBlYWNoIGhvb2tcbiAgaWYgKHN5bmMpIHtcbiAgICByZXR1cm4gc3RhdGUgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGhvb2tzLm1hcChob29rID0+IGhvb2soc3RhdGUpKVxuICAgICAgcmV0dXJuIHJlc3VsdHMuZmlsdGVyKGQgPT4gdHlwZW9mIGQgIT09ICd1bmRlZmluZWQnKVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBzdGF0ZSA9PiB7XG4gICAgY29uc3QgcmVzdWx0cyA9IFtdXG4gICAgY29uc3QgaG9va0xpc3QgPSBob29rcy5tYXAoKGhvb2ssIGluZGV4KSA9PiBhc3luYyAoKSA9PiB7XG4gICAgICByZXN1bHRzW2luZGV4XSA9IGF3YWl0IGhvb2soc3RhdGUpXG5cbiAgICAgIGlmIChob29rTGlzdFtpbmRleCArIDFdKSB7XG4gICAgICAgIHJldHVybiBob29rTGlzdFtpbmRleCArIDFdKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdHMuZmlsdGVyKGQgPT4gdHlwZW9mIGQgIT09ICd1bmRlZmluZWQnKVxuICAgIH0pXG4gICAgcmV0dXJuIGhvb2tMaXN0Lmxlbmd0aCA/IGhvb2tMaXN0WzBdKCkgOiBbXVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRIb29rcyhwbHVnaW5zLCBob29rKSB7XG4gIGlmICghaG9vaykge1xuICAgIHRocm93IG5ldyBFcnJvcignQSBob29rIElEIGlzIHJlcXVpcmVkIScpXG4gIH1cbiAgLy8gVGhlIGZsYXQgaG9va3NcbiAgY29uc3QgaG9va3MgPSBbXVxuXG4gIC8vIEFkZHMgYSBwbHVnaW4gaG9vayB0byB0aGUgaG9vayBsaXN0XG4gIGNvbnN0IGFkZFRvSG9va3MgPSBwbHVnaW4gPT4ge1xuICAgIC8vIEFkZCB0aGUgaG9va1xuICAgIGhvb2tzLnB1c2gocGx1Z2luLmhvb2tzW2hvb2tdKVxuXG4gICAgLy8gUmVjdXJzZSBpbnRvIHN1YiBwbHVnaW5zIGlmIG5lZWRzIGJlXG4gICAgaWYgKHBsdWdpbi5wbHVnaW5zKSB7XG4gICAgICBwbHVnaW4ucGx1Z2lucy5mb3JFYWNoKGFkZFRvSG9va3MpXG4gICAgfVxuICB9XG4gIC8vIFN0YXJ0IHdpdGggdGhlIGNvbmZpZyBwbHVnaW5zXG4gIHBsdWdpbnMuZm9yRWFjaChhZGRUb0hvb2tzKVxuXG4gIC8vIEZpbHRlciBvdXQgZmFsc2V5IGVudHJpZXNcbiAgcmV0dXJuIGhvb2tzLmZpbHRlcihCb29sZWFuKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RnVsbFJvdXRlRGF0YShyb3V0ZUluZm8pIHtcbiAgcmV0dXJuIHtcbiAgICAuLi4ocm91dGVJbmZvLnNoYXJlZERhdGEgPyByb3V0ZUluZm8uc2hhcmVkRGF0YSA6IHt9KSxcbiAgICAuLi5yb3V0ZUluZm8uZGF0YSxcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgUEFUSF80MDQgPSAnNDA0J1xuXG5leHBvcnQgZnVuY3Rpb24gaXM0MDRQYXRoKHBhdGgpIHtcbiAgcmV0dXJuIHBhdGggPT09IFBBVEhfNDA0XG59XG4iXX0=